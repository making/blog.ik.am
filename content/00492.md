---
title: Spring Boot on Cloud Foundryã‹ã‚‰Amazon RDS / Cloud SQLã¸ã®é€šä¿¡ã‚’æš—å·åŒ–ã™ã‚‹
tags: ["Cloud Foundry", "Pivotal Web Services", "Pivotal Cloud Foundry", "Spring Boot", "Java", "TLS", "Amazon RDS", "Cloud SQL"]
categories: ["Programming", "Java", "org", "springframework", "boot"]
---

Amazon RDSã‚„Cloud SQLã¨ã„ã£ãŸCloud Foundryå¤–éƒ¨ã«å­˜åœ¨ã™ã‚‹MySQLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å ´åˆã¯é€šä¿¡ã‚’æš—å·åŒ–ã™ã‚‹ã®ãŒè‰¯ã„ã§ã™ã€‚

ä¾‹ãˆã°ã€æ¬¡ã®ã‚ˆã†ã«`manifest.yml`ã«RDSã®TLSé€šä¿¡ã‚’æœ‰åŠ¹ã«ã—ãŸæ¥ç¶šæƒ…å ±ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®šã—ã€`cf push`ã—ã¦ã¿ã‚‹ã¨ã€ã€

``` yml
applications:
- name: foo
  path: target/demo-0.0.1-SNAPSHOT.jar
  env:
    SPRING_DATASOURCE_DRIVER_CLASS_NAME: com.mysql.jdbc.Driver
    SPRING_DATASOURCE_URL: jdbc:mysql://example.ap-northeast-1.rds.amazonaws.com:3306/cfdemo?useSSL=true&requireSSL=true&verifyServerCertificate=true
    SPRING_DATASOURCE_USERNAME: user
    SPRING_DATASOURCE_PASSWORD: password
```


æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã§ã—ã‚‡ã†ã€‚ã“ã‚Œã¯Cloud Foundryä¸Šã§ãªãã¦ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã§ã‚‚åŒã˜ã§ã™ã€‚


```
Caused by: javax.net.ssl.SSLHandshakeException: java.security.cert.CertificateException: java.security.cert.CertPathValidatorException: Path does not chain with any of the trust anchors
	at sun.security.ssl.Alerts.getSSLException(Alerts.java:192) ~[na:1.8.0_66]
	at sun.security.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1949) ~[na:1.8.0_66]
	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:302) ~[na:1.8.0_66]
	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:296) ~[na:1.8.0_66]
	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1509) ~[na:1.8.0_66]
	at sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:216) ~[na:1.8.0_66]
	at sun.security.ssl.Handshaker.processLoop(Handshaker.java:979) ~[na:1.8.0_66]
	at sun.security.ssl.Handshaker.process_record(Handshaker.java:914) ~[na:1.8.0_66]
	at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:1062) ~[na:1.8.0_66]
	at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1375) ~[na:1.8.0_66]
	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1403) ~[na:1.8.0_66]
	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1387) ~[na:1.8.0_66]
	at com.mysql.jdbc.ExportControlled.transformSocketToSSLSocket(ExportControlled.java:188) ~[mysql-connector-java-5.1.44.jar:5.1.44]
	... 39 common frames omitted
Caused by: java.security.cert.CertificateException: java.security.cert.CertPathValidatorException: Path does not chain with any of the trust anchors
	at com.mysql.jdbc.ExportControlled$X509TrustManagerWrapper.checkServerTrusted(ExportControlled.java:304) ~[mysql-connector-java-5.1.44.jar:5.1.44]
	at sun.security.ssl.AbstractTrustManagerWrapper.checkServerTrusted(SSLContextImpl.java:922) ~[na:1.8.0_66]
	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1491) ~[na:1.8.0_66]
	... 47 common frames omitted
Caused by: java.security.cert.CertPathValidatorException: Path does not chain with any of the trust anchors
	at sun.security.provider.certpath.PKIXCertPathValidator.validate(PKIXCertPathValidator.java:153) ~[na:1.8.0_66]
	at sun.security.provider.certpath.PKIXCertPathValidator.engineValidate(PKIXCertPathValidator.java:79) ~[na:1.8.0_66]
	at java.security.cert.CertPathValidator.validate(CertPathValidator.java:292) ~[na:1.8.0_66]
	at com.mysql.jdbc.ExportControlled$X509TrustManagerWrapper.checkServerTrusted(ExportControlled.java:297) ~[mysql-connector-java-5.1.44.jar:5.1.44]
	... 49 common frames omitted
```

`Path does not chain with any of the trust anchors`ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚‹ã®ã¯ã€æ¥ç¶šå…ˆã®CAè¨¼æ˜æ›¸ãŒä¿¡é ¼æ¸ˆã¿ã®è¨¼æ˜æ›¸ä¸€è¦§ã«å«ã¾ã‚Œã¦ã„ãªã„ãŸã‚ã§ã™ã€‚

Javaã®å ´åˆã€ä¿¡é ¼æ¸ˆã¿ã®è¨¼æ˜æ›¸ã¯Keystoreã«è¨­å®šã•ã‚Œã¦ãŠã‚Šã€JDKå´ã§ç®¡ç†ã•ã‚Œã„ã¾ã™ã€‚

CAè¨¼æ˜æ›¸ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚’3ãƒ‘ã‚¿ãƒ¼ãƒ³ç´¹ä»‹ã—ã¾ã™ã€‚

**ç›®æ¬¡**

<!-- toc -->


### `keytool`ã‚’åˆ©ç”¨ã—ã¦ä¿¡é ¼ã•ã‚ŒãŸCAè¨¼æ˜æ›¸ã‚’è¿½åŠ ã™ã‚‹

Amazon RDSã‚‚Cloud SQLã‚‚CAè¨¼æ˜æ›¸ã¯å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€`keytool`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ã“ã‚Œã‚’importã™ã‚Œã°è‰¯ã„ã§ã™ã€‚

#### Amazon RDSã®å ´åˆ

[http://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/UsingWithRDS.SSL.html#UsingWithRDS.SSL.IntermediateCertificates](http://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/UsingWithRDS.SSL.html#UsingWithRDS.SSL.IntermediateCertificates)

ã‹ã‚‰ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã£ãŸä¸­é–“è¨¼æ˜æ›¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚

`ap-northeast-1`ã®ä¾‹ã§èª¬æ˜ã—ã¾ã™ã€‚

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§`rds-ca-2015-ap-northeast-1.pem`ã‹ã‚‰`src/main/resources`ç›´ä¸‹ã«`rds-ca.jks`ã‚’ä½œæˆã—ã¾ã™ã€‚

```
cd your-app
wget https://s3.amazonaws.com/rds-downloads/rds-ca-2015-ap-northeast-1.pem

keytool -keystore src/main/resources/rds-ca.jks -storepass changeit -importcert -noprompt -alias MyCert -file rds-ca-2015-ap-northeast-1.pem 
```

å†åº¦ã€`mvn package`ã‚’è¡Œã„ã€`rds-ca.jks`ã‚’åŒæ¢±ã—ãŸjarãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

ãã—ã¦ã€ç’°å¢ƒå¤‰æ•°`JAVA_OPT`ã«ä½œæˆã—ãŸkeystoreã®ãƒ‘ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã™ã€‚

``` yml
applications:
- name: foo
  path: target/demo-0.0.1-SNAPSHOT.jar
  env:
    SPRING_DATASOURCE_DRIVER_CLASS_NAME: com.mysql.jdbc.Driver
    SPRING_DATASOURCE_URL: jdbc:mysql://example.ap-northeast-1.rds.amazonaws.com:3306/cfdemo?useSSL=true&requireSSL=true&verifyServerCertificate=true
    SPRING_DATASOURCE_USERNAME: user
    SPRING_DATASOURCE_PASSWORD: password
    JAVA_OPTS: '-Djavax.net.ssl.trustStore=/home/vcap/app/BOOT-INF/classes/rds-ca.jks -Djavax.net.ssl.trustStorePassword=changeit'
```

Cloud Foundryã®ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§ã¯jarãƒ•ã‚¡ã‚¤ãƒ«ã¯`/home/vcap/app`ã«å±•é–‹ã•ã‚ŒãŸå½¢ã«ãªã‚Šã¾ã™ã®ã§ã€keystoreã®ãƒ‘ã‚¹ã¯`/home/vcap/app/BOOT-INF/classes/rds-ca.jks`ã§ã™ã€‚

ã“ã‚Œã§`cf push`ã—ç›´ã›ã°ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãªãRDSã«TLSã§é€šä¿¡ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚

> ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§`useSSL=true`ã‚’æœ‰åŠ¹ã«ã—ãŸã„å ´åˆã¯ã€JVMã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«
> 
> ```
> -Djavax.net.ssl.trustStore=/Users/.../you-app/src/main/resources/rds-ca.jks -Djavax.net.ssl.trustStorePassword=changeit
> ```
>
> ã‚’è¿½åŠ ã™ã‚Œã°è‰¯ã„ã§ã™ã€‚

#### Cloud SQLã®å ´åˆ

"SSL"ã‚¿ãƒ–ã®"View Server CA Certificate"ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€

![image.png](https://qiita-image-store.s3.amazonaws.com/0/1852/bc44a476-f593-0f90-3d68-aaaa964dfe67.png)

"Download server-ca.pem"ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€`you-app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª(ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)ã«ä¿å­˜ã—ã¦ãã ã•ã„ã€‚

![image.png](https://qiita-image-store.s3.amazonaws.com/0/1852/a738b007-4425-eac1-57fb-a69bee2f177d.png)


æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§`server-ca.pem`ã‹ã‚‰`src/main/resources`ç›´ä¸‹ã«`cloudsql-ca.jks`ã‚’ä½œæˆã—ã¾ã™ã€‚

```
cd your-app

keytool -keystore src/main/resources/cloudsql-ca.jks -storepass changeit -importcert -noprompt -alias MyCert -file server-ca.pem
```

ã‚ã¨ã¯RDSã®å ´åˆã¨åŒã˜ã§ã™ã€‚

å†åº¦ã€`mvn package`ã‚’è¡Œã„ã€`cloudsql-ca.jks`ã‚’åŒæ¢±ã—ãŸjarãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

ãã—ã¦ã€ç’°å¢ƒå¤‰æ•°`JAVA_OPT`ã«ä½œæˆã—ãŸkeystoreã®ãƒ‘ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã™ã€‚

``` yml
applications:
- name: foo
  path: target/demo-0.0.1-SNAPSHOT.jar
  env:
    SPRING_DATASOURCE_DRIVER_CLASS_NAME: com.mysql.jdbc.Driver
    SPRING_DATASOURCE_URL: jdbc:mysql://aaa.bbb.ccc.ddd:3306/cfdemo?useSSL=true&requireSSL=true&verifyServerCertificate=true
    SPRING_DATASOURCE_USERNAME: user
    SPRING_DATASOURCE_PASSWORD: password
    JAVA_OPTS: '-Djavax.net.ssl.trustStore=/home/vcap/app/BOOT-INF/classes/cloudsql-ca.jks -Djavax.net.ssl.trustStorePassword=changeit'
```

Cloud Foundryã®ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§ã¯jarãƒ•ã‚¡ã‚¤ãƒ«ã¯`/home/vcap/app`ã«å±•é–‹ã•ã‚ŒãŸå½¢ã«ãªã‚Šã¾ã™ã®ã§ã€keystoreã®ãƒ‘ã‚¹ã¯`/home/vcap/app/BOOT-INF/classes/cloudsql-ca.jks`ã§ã™ã€‚

ã“ã‚Œã§`cf push`ã—ç›´ã›ã°ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãªãCloud SQLã«TLSã§é€šä¿¡ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚



### ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ã‚¯ã«ä¿¡é ¼ã•ã‚ŒãŸCAè¨¼æ˜æ›¸ã‚’è¿½åŠ ã™ã‚‹

å‰è¿°ã®ã‚„ã‚Šæ–¹ã¯`keytool`ã‚’ä½¿ã£ã¦keystoreãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€jarã«åŒæ¢±ã—ã€`JAVA_OPTS`ã«ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã™ã‚‹ã¨ã„ã†ã‚„ã‚Šæ–¹ã§å°‘ã—æ‰‹é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚

å®Ÿã¯å…¨ãåŒã˜ã“ã¨ã¯æ¬¡ã®Javaã‚³ãƒ¼ãƒ‰ã§å®Ÿç¾å¯èƒ½ã§ã™ã€‚

``` java
String serverCaPem = "-----BEGIN CERTIFICATE-----\n" +
        "...\n" +
        "-----END CERTIFICATE-----";
CertificateFactory fact = CertificateFactory.getInstance("X.509");
Certificate certificate = fact.generateCertificate(new ByteArrayInputStream(serverCaPem.getBytes()));

KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType());
trustStore.load(null); // init empty keystore
trustStore.setCertificateEntry("imported", certificate);

String password = UUID.randomUUID().toString();
File trustStoreOutputFile = File.createTempFile("truststore", null);
trustStoreOutputFile.deleteOnExit();
trustStore.store(new FileOutputStream(trustStoreOutputFile), password.toCharArray());
System.setProperty("javax.net.ssl.trustStore", trustStoreOutputFile.getAbsolutePath());
System.setProperty("javax.net.ssl.trustStorePassword", password);
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã®å‰ã«è¡Œãˆã°è‰¯ã„ã§ã™ã€‚`main`ãƒ¡ã‚½ãƒƒãƒ‰ã®`SpringApplication.run(DemoApplication.class, args);`ã®å‰ã§å®Ÿè¡Œã—ã¦ãŠã‘ã°ç¢ºå®Ÿã§ã™ã€‚

#### `certificate-importer`ã‚’åˆ©ç”¨ã™ã‚‹

ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒšã™ã‚‹ã®ã¯é¢å€’ã§ã™ã®ã§ã€
ã“ã‚Œã‚’è‡ªå‹•ã§å®Ÿè¡Œã—ã¦ãã‚Œã‚‹[certificate-importer](https://github.com/making/certificate-importer)ã¨è¨€ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œæˆã—ãŸã®ã§ã€ã‚ˆã‚Šç°¡å˜ã«CAè¨¼æ˜æ›¸ã‚’Keystoreã«è¿½åŠ å¯èƒ½ã§ã™ã€‚

ä½¿ã„æ–¹ã¯`pom.xml`ã«æ¬¡ã®ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã—ã€

``` xml
<dependency>
    <groupId>am.ik.certificate</groupId>
    <artifactId>certificate-importer</artifactId>
    <version>0.0.1</version>
</dependency>
```

Spring Bootã‚¢ãƒ—ãƒªã®å ´åˆã¯ã€ç’°å¢ƒå¤‰æ•°`CA_CERTS`ã¾ãŸã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£`ca.certs`ã«è¿½åŠ ã—ãŸã„CAè¨¼æ˜æ›¸ã‚’PEMå½¢å¼ã§è¨­å®šã™ã‚‹ã ã‘ã§ã™ã€‚

`application-cloud.yml`ã«æ¬¡ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹ã®ãŒä¾¿åˆ©ã§ã—ã‚‡ã†ã€‚


``` yml
spring.datasource.driver-class-name: com.mysql.jdbc.Driver
spring.datasource.url: jdbc:mysql://example.ap-northeast-1.rds.amazonaws.com:3306/cfdemo?useSSL=true&requireSSL=true&verifyServerCertificate=true
spring.datasource.username: user
spring.datasource.password: password
ca.certs: | 
    -----BEGIN CERTIFICATE-----
    MIIEATCCAumgAwIBAgIBRDANBgkqhkiG9w0BAQUFADCBijELMAkGA1UEBhMCVVMx
    EzARBgNVBAgMCldhc2hpbmd0b24xEDAOBgNVBAcMB1NlYXR0bGUxIjAgBgNVBAoM
    GUFtYXpvbiBXZWIgU2VydmljZXMsIEluYy4xEzARBgNVBAsMCkFtYXpvbiBSRFMx
    GzAZBgNVBAMMEkFtYXpvbiBSRFMgUm9vdCBDQTAeFw0xNTAyMDUyMjAzMDZaFw0y
    MDAzMDUyMjAzMDZaMIGUMQswCQYDVQQGEwJVUzETMBEGA1UECAwKV2FzaGluZ3Rv
    bjEQMA4GA1UEBwwHU2VhdHRsZTEiMCAGA1UECgwZQW1hem9uIFdlYiBTZXJ2aWNl
    cywgSW5jLjETMBEGA1UECwwKQW1hem9uIFJEUzElMCMGA1UEAwwcQW1hem9uIFJE
    UyBhcC1ub3J0aGVhc3QtMSBDQTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC
    ggEBAMmM2B4PfTXCZjbZMWiDPyxvk/eeNwIRJAhfzesiGUiLozX6CRy3rwC1ZOPV
    AcQf0LB+O8wY88C/cV+d4Q2nBDmnk+Vx7o2MyMh343r5rR3Na+4izd89tkQVt0WW
    vO21KRH5i8EuBjinboOwAwu6IJ+HyiQiM0VjgjrmEr/YzFPL8MgHD/YUHehqjACn
    C0+B7/gu7W4qJzBL2DOf7ub2qszGtwPE+qQzkCRDwE1A4AJmVE++/FLH2Zx78Egg
    fV1sUxPtYgjGH76VyyO6GNKM6rAUMD/q5mnPASQVIXgKbupr618bnH+SWHFjBqZq
    HvDGPMtiiWII41EmGUypyt5AbysCAwEAAaNmMGQwDgYDVR0PAQH/BAQDAgEGMBIG
    A1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFIiKM0Q6n1K4EmLxs3ZXxINbwEwR
    MB8GA1UdIwQYMBaAFE4C7qw+9hXITO0s9QXBj5yECEmDMA0GCSqGSIb3DQEBBQUA
    A4IBAQBezGbE9Rw/k2e25iGjj5n8r+M3dlye8ORfCE/dijHtxqAKasXHgKX8I9Tw
    JkBiGWiuzqn7gO5MJ0nMMro1+gq29qjZnYX1pDHPgsRjUX8R+juRhgJ3JSHijRbf
    4qNJrnwga7pj94MhcLq9u0f6dxH6dXbyMv21T4TZMTmcFduf1KgaiVx1PEyJjC6r
    M+Ru+A0eM+jJ7uCjUoZKcpX8xkj4nmSnz9NMPog3wdOSB9cAW7XIc5mHa656wr7I
    WJxVcYNHTXIjCcng2zMKd1aCcl2KSFfy56sRfT7J5Wp69QSr+jq8KM55gw8uqAwi
    VPrXn2899T1rcTtFYFP16WXjGuc0
    -----END CERTIFICATE-----
```


Spring Bootã‚¢ãƒ—ãƒªä»¥å¤–ã®å ´åˆã¯ã€æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§importå¯èƒ½ã§ã™ã€‚


``` java
String serverCaPem = "-----BEGIN CERTIFICATE-----\n" +
        "...\n" +
        "-----END CERTIFICATE-----";

CertificateImporter certificateImporter = new CertificateImporter();
certificateImporter.doImport(serverCaPem);
```


### Cloud Foundryå…¨ä½“ã§ä¿¡é ¼ã•ã‚ŒãŸCAè¨¼æ˜æ›¸ã‚’è¿½åŠ ã™ã‚‹

ä¸Šè¨˜ã®2æ–¹æ³•ã¯ã©ã‚Œã‚‚ã€å„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦è¨­å®šãŒå¿…è¦ã§ã™ã€‚

Cloud Foundryã®Java Buildpackã«ã¯[Container Security Provider](https://github.com/cloudfoundry/java-buildpack/blob/master/docs/framework-container_security_provider.md)ã¨ã„ã†ä»•çµ„ã¿ãŒã‚ã‚Šã€Container Security Providerã¯BOSH Directorã«è¨­å®šã•ã‚ŒãŸ[Trusted Certificates](https://bosh.io/docs/trusted-certs.html)ã‚’è‡ªå‹•ã§Keystoreã«è¿½åŠ ã—ã¦ãã‚Œã¾ã™ã€‚ã“ã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã¨å„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

> Javaã«ä¾ã‚‰ãšã€BOSH Trusted Certificatesã¯ã‚³ãƒ³ãƒ†ãƒŠå†…ã®`/etc/ssl/certs/ca-certificates.crt`ã«å«ã¾ã‚Œã¾ã™ã€‚

Pivotal Cloud Foundryã®å ´åˆã¯ã€"Ops Manager Director" Tileã®"Security"ã‚¿ãƒ–ã§BOSH Trusted Certificatesã‚’è¨­å®šå¯èƒ½ã§ã™ã€‚

![image.png](https://qiita-image-store.s3.amazonaws.com/0/1852/931ff871-dacc-8494-3b27-8514e9c7e57a.png)


http://docs.pivotal.io/pivotalcf/1-12/customizing/cloudform-om-config.html#security


ã“ã®è¨­å®šã‚’è¡Œã£ãŸå ´åˆã¯ã€Java Buildpackã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã‚¢ãƒ—ãƒªã®Keystoreã«è‡ªå‹•ã§CAè¨¼æ˜æ›¸ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚

---

> [MySQL for PCF](http://docs.pivotal.io/p-mysql/)ã¯è¨˜äº‹åŸ·ç­†æ™‚ç‚¹ã§æš—å·åŒ–é€šä¿¡æœªå¯¾å¿œğŸ˜¨ã§ã™...(ç¾åœ¨å¯¾å¿œä¸­)
> Pivotal Cloud Foundryãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ä»£æ›¿æ‰‹æ®µã¨ã—ã¦[IPsec Add-on](http://docs.pivotal.io/addon-ipsec/)ã‚’ä½¿ã£ã¦ã€é€šä¿¡ã®æš—å·åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ğŸ˜Œ

æœ¬è¨˜äº‹ã§ç´¹ä»‹ã—ãŸCAè¨¼æ˜æ›¸ã®è¿½åŠ æ–¹æ³•ã¯MySQLã«é™ã£ãŸè©±ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚HTTPã‚„ä»–ã®TCPé€šä¿¡ã§åŒã˜ã§ã™ã€‚

ã“ã¡ã‚‰ã®[Knowledge Base](https://discuss.pivotal.io/hc/en-us/articles/223454928-How-to-tell-application-containers-running-Java-apps-to-trust-self-signed-certs-or-a-private-or-internal-CA)ãŒå½¹ã«ç«‹ã¡ã¾ã—ãŸã€‚

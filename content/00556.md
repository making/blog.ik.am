---
title: Kubernetesãƒãƒ³ã‚ºã‚ªãƒ³ - 6. æ°¸ç¶šãƒœãƒªãƒ¥ãƒ¼ãƒ ã®åˆ©ç”¨
tags: ["Kubernetes Handson", "Kubernetes", "PKS"]
categories: ["Dev", "CaaS", "Kubernetes"]
updated: 1970-01-01T09:00:00+09:00
---

ã“ã“ã¾ã§æ‰±ã£ã¦ããŸ`hello-pks`ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€
ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
Kubernetesè‡ªä½“ã¯ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ã§ãªãã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚ˆã†ãªã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ãªãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ã®ãŸã‚ã«ã¯æ°¸ç¶šãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

å®Ÿã¯ã“ã‚Œã¾ã§ã«Volumeè‡ªä½“ã¯æ‰±ã£ã¦ãã¾ã—ãŸã€‚
ConfigMapã‚„Secretã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ãƒã‚¦ãƒ³ãƒˆã—ãŸéš›ã«Volumeã®å®šç¾©ã‚’ã—ã¾ã—ãŸã—ã€
Init Containersã§ã®å‡¦ç†å†…å®¹ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«å¼•ãç¶™ããŸã‚ã«Podå†…ã§ã®ã¿åˆ©ç”¨å¯èƒ½ãª`emptyDir`ã¨ã„ã†Volumeã‚’ä½¿ã„ã¾ã—ãŸã€‚

ã“ã“ã§ã¯PodãŒç ´æ£„ã•ã‚Œã¦ã‚‚å­˜åœ¨ã—ç¶šã‘ã‚‹Volumeã«ã¤ã„ã¦æ‰±ã„ã¾ã™ã€‚

Podã«å®Ÿéš›ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã‚ã‚‹æ°¸ç¶šãƒœãƒªãƒ¥ãƒ¼ãƒ ã¯`PersistentVolume`ã¨ã„ã†ãƒªã‚½ãƒ¼ã‚¹ã§è¡¨ç¾ã•ã‚Œã¾ã™ã€‚
Developerã¯Podã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹éš›ã«`PersistentVolumeClaim`ã¨ã„ã†ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã€
Kubernetesã«å¯¾ã—ã¦ã€å¿…è¦ãªspecã®`PersistentVolume`ã‚’è¦æ±‚ã—ã¾ã™ã€‚ãã®çµæœã€å¿…è¦ãªspecã«åˆã£ãŸ`PersistentVolume`ãŒPodã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¾ã™ã€‚

`PersistentVolume`ã®ä½œæˆã¯é™çš„ã«è¡Œã†æ–¹æ³•ã¨å‹•çš„ã«è¡Œã†æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚
é™çš„ãªå ´åˆã¯(é€šå¸¸ã¯)Kubernetesç®¡ç†è€…ãŒ`PersistentVolume`ã‚’äºˆã‚ä½œæˆã—ã€DeveloperãŒ`PersistentVolumeClaim`ã§ä»•æ§˜è¦æ±‚ã™ã‚‹å½¢ã«ãªã‚Šã¾ã™ã€‚

![image](https://user-images.githubusercontent.com/106908/39109758-36728b82-4709-11e8-900a-1671e17e07f4.png)

å‹•çš„ãªå ´åˆã¯ã€`PersistentVolumeClaim`ã§ä»•æ§˜è¦æ±‚ã«å¯¾ã—ã¦ã€ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã§`PersistentVolume`ãŒä½œæˆã•ã‚Œã¾ã™ã€‚
ã“ã®å ´åˆã¯ProvisionerãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯Kubernetesã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ–¹æ³•ã«ä¾ã£ã¦ç•°ãªã‚Šã¾ã™ã€‚

ä»Šå›ã¯å‹•çš„ã«ç”Ÿæˆã™ã‚‹æ–¹æ³•ã®ã¿èª¬æ˜ã—ã¾ã™ã€‚

**ç›®æ¬¡**

<!-- toc -->

### PersistentVolumeã®å‹•çš„ä½œæˆ

PersistentVolumeã®ProvisionerãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€PersistentVolumeã‚’å‹•çš„ã«ä½œæˆã§ãã¾ã™ã€‚
ã“ã®å ´åˆã¯äº‹å‰ã«PersistentVolumeã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ç”¨æ„ã™ã‚‹å¿…è¦ã¯ãªãã€PersistentVolumeClaimã ã‘ä½œæˆã™ã‚Œã°è‰¯ã„ã§ã™ã€‚

ProvisionerãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã¯`kubectl get storageclass`ã§`StorageClass`ãƒªã‚½ãƒ¼ã‚¹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã§ç¢ºèªã§ãã¾ã™ã€‚

```
kubectl get storageclass
```

å‡ºåŠ›ä¾‹
```
$ kubectl get storageclass
NAME                 PROVISIONER             AGE
standard (default)   kubernetes.io/aws-ebs   252d
```

> `StorageClass`ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€[ã“ã¡ã‚‰](https://docs.pivotal.io/pks/1-5/volumes.html#dynamic-pv-pks)ã‚’å‚ç…§ã—ã¦ä½œæˆã—ã¦ãã ã•ã„ã€‚

`mysql-pvc.yml`ã‚’ä½œæˆã—ã¦ã€æ¬¡ã®å†…å®¹ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pvc
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
```


`kubectl apply`ã§`PersistentVolumeClaim`ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚


```
kubectl apply -f mysql-pvc.yml 
```
å‡ºåŠ›çµæœ
```
persistentvolumeclaim/mysql-pvc created
```

`kubectl get pv,pvc`ã§`PersistentVolume`ã¨`PersistentVolumeClaim`ã®ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```
kubectl get pv,pvc
```
å‡ºåŠ›çµæœä¾‹
```
NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM               STORAGECLASS   REASON   AGE
persistentvolume/pvc-56d358ab-de0f-11e9-812f-06c9c16b7d62   1Gi        RWO            Delete           Bound    default/mysql-pvc   standard                20s

NAME                              STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/mysql-pvc   Bound    pvc-56d358ab-de0f-11e9-812f-06c9c16b7d62   1Gi        RWO            standard       23s
```

`PersistentVolumeClaim`ã«å¯¾å¿œã—ãŸ`PersistentVolume`ãŒè‡ªå‹•ã§ä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

å‹•çš„ãª`PersistentVolume`ä½œæˆã¯ä¾¿åˆ©ãªã®ã§ã€åŸºæœ¬çš„ã«ã¯ã“ã¡ã‚‰ã‚’ä½¿ãˆã°è‰¯ã„ã§ã™ãŒã€Volumeã«é–¢ã™ã‚‹è©³ç´°ãªè¨­å®šãŒå¿…è¦ãªå ´åˆã¯`PersistentVolume`ã‚’é™çš„ã«ä½œæˆã—ã¦ãã ã•ã„ã€‚

### PersistentVolumeClaimã®åˆ©ç”¨

`PersistentVolume`ã‚’ã‚³ãƒ³ãƒ†ãƒŠã§ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã“ã§ã¯MySQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã€`PersistentVolume`ã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ã€‚

`mysql.yml`ã‚’ä½œæˆã—ã¦ã€æ¬¡ã®å†…å®¹ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql
spec:
  selector:
    matchLabels:
      app: mysql
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: mysql
    spec:
      initContainers:
      - name: remove-lost-found
        image: busybox
        command:          
        - sh
        - -c
        - |
          rm -fr /var/lib/mysql/lost+found
        volumeMounts:
        - name: mysql-persistent-storage
          mountPath: /var/lib/mysql
      containers:
      - image: mysql:5.7
        name: mysql
        env:
        - name: MYSQL_DATABASE
          value: demo
        - name: MYSQL_ROOT_PASSWORD
          value: password
        - name: MYSQL_USER
          value: pksuser
        - name: MYSQL_PASSWORD
          value: pkspassword
        ports:
        - containerPort: 3306
          name: mysql
        volumeMounts:
        - name: mysql-persistent-storage
          mountPath: /var/lib/mysql
      volumes:
      - name: mysql-persistent-storage
        persistentVolumeClaim:
          claimName: mysql-pvc
```

`spec.template.spec.volumes[].persistentVolumeClaim.claimName`ã«ä½œæˆæ¸ˆã¿ã®PersistentVolumeClaimåã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚

> `spec.template.spec.initContainers`ã®éƒ¨åˆ†ã¯æœ¬è³ªçš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€VsphereVolumeãªã©PersistentVolumeã®ç¨®é¡ã«ã‚ˆã£ã¦ã¯ãƒã‚¦ãƒ³ãƒˆã—ãŸãƒ‡ã‚£ã‚¹ã‚¯ä¸Šã«`lost+found`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã€ã“ã‚ŒãŒåŸå› ã§MySQLãŒèµ·å‹•ã—ãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’é¿ã‘ã‚‹ãŸã‚ã«ã€`initContainers`ã®å‡¦ç†ã§`lost+found`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤ã—ã¦ã„ã¾ã™ã€‚

ã“ã®manifestã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„ã€‚

```
kubectl apply -f mysql.yml
```
å‡ºåŠ›çµæœ
```
deployment.apps/mysql created
```

ä½œæˆç›´å¾Œã¯MySQLã®Podã®`STATUS`ãŒ`Init`ã«ãªã£ã¦ã„ã¾ã™ã€‚

```
kubectl get pod -l app=mysql
```
å‡ºåŠ›çµæœ

```
NAME                     READY   STATUS     RESTARTS   AGE
mysql-6788b57948-84pj2   0/1     Init:0/1   0          10s
```

ã—ã°ã‚‰ãã—ãŸå¾Œã€å†åº¦å®Ÿè¡Œã—ã¦ã€MySQLã®Podã®`STATUS`ãŒ`Running`ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

å‡ºåŠ›çµæœ
```
NAME                     READY   STATUS    RESTARTS   AGE
mysql-6788b57948-84pj2   1/1     Running   0          44s
```

`kubectl exec <Podå>`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦Podä¸Šã§ä»»æ„ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚
ã“ã‚Œã‚’ç”¨ã„ã¦`mysql-xxxxxxx-xxxxx`Podä¸Šã§`mysql`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€localhostã®MySQLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚(Podåã¯å¤‰æ›´ã—ã¦ãã ã•ã„)

```
kubectl exec mysql-6788b57948-84pj2 -ti -- mysql -u pksuser -ppkspassword demo
```
ã¾ãŸã¯æ¬¡ã®ã‚ˆã†ã«Podåã‚’å–å¾—ã—ã¦å®Ÿè¡Œã§ãã¾ã™ã€‚
```
kubectl exec $(kubectl get pod -l app=mysql -o jsonpath='{.items[?(@.status.phase=="Running")].metadata.name}') -ti -- mysql -u pksuser -ppkspassword demo
```

å‡ºåŠ›çµæœ
```
mysql: [Warning] Using a password on the command line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 2
Server version: 5.7.27 MySQL Community Server (GPL)

Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> 
```

ç¶šã‘ã¦æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆã¨ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚


```sql
CREATE TABLE hello (
  id       INT AUTO_INCREMENT PRIMARY KEY,
  text     VARCHAR(255)
);
INSERT INTO hello(text) VALUES('Hello World!');
```
å‡ºåŠ›çµæœ
```
mysql> CREATE TABLE hello (
    ->   id       INT AUTO_INCREMENT PRIMARY KEY,
    ->   text     VARCHAR(255)
    -> );
Query OK, 0 rows affected (0.05 sec)

mysql> INSERT INTO hello(text) VALUES('Hello World!');
Query OK, 1 row affected (0.00 sec)
```

`quit`ã‚’å…¥åŠ›ã—ã€`mysql`ã‚³ãƒãƒ³ãƒ‰ã‚’çµ‚äº†ã—ã¦ãã ã•ã„ã€‚

å‡ºåŠ›çµæœ
```
mysql> quit
Bye
```

ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§ã™ã‚‹ãŸã‚ã«ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚(Podåã¯å¤‰æ›´ã—ã¦ãã ã•ã„)

```
kubectl exec mysql-6788b57948-84pj2 -- mysql -u pksuser -ppkspassword demo -e 'SELECT * FROM hello'
```
ã¾ãŸã¯æ¬¡ã®ã‚ˆã†ã«Podåã‚’å–å¾—ã—ã¦å®Ÿè¡Œã§ãã¾ã™ã€‚
```
kubectl exec $(kubectl get pod -l app=mysql -o jsonpath='{.items[?(@.status.phase=="Running")].metadata.name}') -- mysql -u pksuser -ppkspassword demo -e 'SELECT * FROM hello'
```

å‡ºåŠ›çµæœ
```
id  text
1 Hello World!
mysql: [Warning] Using a password on the command line interface can be insecure.
```

ã“ã“ã§ä¸€åº¦Podã‚’å‰Šé™¤ã—ã¾ã—ã‚‡ã†ã€‚

```
kubectl delete pod -l app=mysql
```
å‡ºåŠ›çµæœ
```
pod "mysql-6788b57948-84pj2" deleted
```

ã—ã°ã‚‰ãã™ã‚‹ã¨ReplicaSetã«ã‚ˆã‚Šã€PodãŒå¾©æ—§ã—ã¾ã™ã€‚Podä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```
kubectl get pod -l app=mysql
```
å‡ºåŠ›çµæœ
```
NAME                     READY   STATUS    RESTARTS   AGE
mysql-6788b57948-m5zbl   1/1     Running   0          19s
```

æ–°ã—ãä½œæˆã•ã‚ŒãŸPodä¸Šã§`mysql`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€å…ˆã»ã©ç™»éŒ²ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```
kubectl exec mysql-6788b57948-m5zbl -- mysql -ppassword demo -e 'SELECT * FROM hello'
```
ã¾ãŸã¯æ¬¡ã®ã‚ˆã†ã«Podåã‚’å–å¾—ã—ã¦å®Ÿè¡Œã§ãã¾ã™ã€‚
```
kubectl exec $(kubectl get pod -l app=mysql -o jsonpath='{.items[?(@.status.phase=="Running")].metadata.name}') -- mysql -u pksuser -ppkspassword demo -e 'SELECT * FROM hello'
```

å‡ºåŠ›çµæœ
```
mysql: [Warning] Using a password on the command line interface can be insecure.
id  text
1 Hello World!
```

PodãŒå‰Šé™¤ã•ã‚Œã¦ã‚‚PersistentVolumeã«æ ¼ç´ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯å¤±ã‚ã‚Œãªã„ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

### MySQLç”¨manifestã®æ›´æ–°

ã“ã“ã‹ã‚‰ã¯ã“ã‚Œã¾ã§èª¬æ˜ã—ãŸå†…å®¹ã‚’ä½¿ã£ã¦ã€manifestã‚’æ›´æ–°ã—ã¾ã™ã€‚
`PersistentVolume`ã®å­¦ç¿’ã¨ã¯ç›´æ¥é–¢ä¿‚ãŒãªã„ã®ã§ã€æ™‚é–“ãŒãªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚

#### ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å…¬é–‹

ä»–ã®ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰MySQLã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«Serviceã‚’ä½œæˆã—ã€MySQLã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¯ãƒ©ã‚¹ã‚¿å†…ã«å…¬é–‹ã—ã¾ã™ã€‚

`mysql-service.yml`ã‚’ä½œæˆã—ã¦ã€æ¬¡ã®å†…å®¹ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

```yaml
apiVersion: v1
kind: Service
metadata:
  name: mysql
spec:
  ports:
  - port: 3306
  selector:
    app: mysql
  clusterIP: None
```

> `ClusterIP: None`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€å†…éƒ¨DNSã§ã‚µãƒ¼ãƒ“ã‚¹åã‚’è§£æ±ºã™ã‚‹ã¨Podã®IPãŒç›´æ¥è¿”ã‚Šã¾ã™(Headlessãƒ¢ãƒ¼ãƒ‰)ã€‚

ã“ã®manifestã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„ã€‚

```
kubectl apply -f mysql-service.yml
```
å‡ºåŠ›çµæœ
```
service/mysql created
```

åŒä¸€Namespaceã‹ã‚‰ã¯ãƒ›ã‚¹ãƒˆåã‚’`Serviceå`ã€ã™ãªã‚ã¡`mysql`ã§MySQLã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚

```
kubectl run -it --rm --image=mysql:5.7 --restart=Never mysql-client -- mysql -h mysql -u pksuser -ppkspassword demo -e 'SELECT * FROM hello'
```
å‡ºåŠ›çµæœ
```
mysql: [Warning] Using a password on the command line interface can be insecure.
+----+--------------+
| id | text         |
+----+--------------+
|  1 | Hello World! |
+----+--------------+
pod "mysql-client" deleted
```

NamespaceãŒç•°ãªã‚‹å ´åˆã€`Serviceå.Namespace`ã€ã“ã“ã§ã¯`default` Namespaceã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€`mysql.default`ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚ã‚ã‚‹ã„ã¯å®Œå…¨ä¿®é£¾åã§`mysql.default.svc.cluster.local`ã¨ã—ã¦ã‚‚è‰¯ã„ã§ã™ã€‚
ã“ã®å ´åˆã¯å†…éƒ¨DNS(KubeDNS)ã«ã‚ˆã£ã¦åå‰è§£æ±ºã•ã‚Œã¾ã™ã€‚

```
kubectl run -it --rm --image=mysql:5.7 --restart=Never mysql-client -- mysql -h mysql.default.svc.cluster.local -u pksuser -ppkspassword demo -e 'SELECT * FROM hello'
```

#### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’Secretã«ä¿å­˜

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰(`MYSQL_ROOT_PASSWORD`)ã‚’`env.value`ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã¯é‹ç”¨ä¸Šã¯ã‚ã‚Šå¾—ã¾ã›ã‚“ã€‚
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯Secretã«ä¿å­˜ã—ã€`env.valueFrom`ã§å‚ç…§ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

`mysql-secret.yml`ã‚’ä½œæˆã—ã¦ã€æ¬¡ã®å†…å®¹ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: mysql-secret
type: Opaque
stringData:
  MYSQL_ROOT_PASSWORD: password
  MYSQL_USER: pksuser
  MYSQL_PASSWORD: pkspassword
```

ã“ã®manifestã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„ã€‚

```
kubectl apply -f mysql-secret.yml 
```
å‡ºåŠ›çµæœ
```
secret/mysql-secret created
```

`mysql.yml`ã‚’æ¬¡ã®å†…å®¹ã«æ›´æ–°ã—ã¦ãã ã•ã„ã€‚

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql
spec:
  # ...
  template:
    # ...
    spec:
      initContainers:
      # ...
      containers:
      - image: mysql:5.7
        name: mysql
        env:
        - name: MYSQL_DATABASE
          value: demo
        # ã“ã“ã‹ã‚‰å¤‰æ›´
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_ROOT_PASSWORD
        - name: MYSQL_USER
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_USER
        - name: MYSQL_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_PASSWORD
        # ã“ã“ã¾ã§
        # ...
```

æ›´æ–°å†…å®¹ã‚’é©ç”¨ã—ã¦ãã ã•ã„ã€‚

```
kubectl apply -f mysql.yml
```
å‡ºåŠ›çµæœ
```
deployment.apps/mysql configured
```

> ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸå ´åˆã¯ã€ç’°å¢ƒå¤‰æ•°`MYSQL_ROOT_PASSWORD`ã®å¤‰æ›´ã ã‘ã§ã¯åæ˜ ã•ã‚Œã¾ã›ã‚“ã€‚`mysql`ã‚³ãƒãƒ³ãƒ‰ã§ç›´æ¥å¤‰æ›´ã‚’åæ˜ ã—ã¦ãã ã•ã„ã€‚ã‚ã‚‹ã„ã¯`kubectl delete -f mysql-pvc.yml`ã§Persistent Volume Claimã¨Persistent Volumeå‰Šé™¤ã—ã¦ã€ä¸Šè¨˜ã®æ‰‹é †ã‚’ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚

#### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ConfigMapã«ä¿å­˜

`mysql` Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ`character_set_server`ã¯`latin1`ã§ã™ã€‚æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã§ãã¾ã™ã€‚

```
kubectl run -it --rm --image=mysql:5.7 --restart=Never mysql-client -- mysql -h mysql -u pksuser -ppkspassword -e 'show variables like "chara%";'
```
å‡ºåŠ›çµæœ
```
mysql: [Warning] Using a password on the command line interface can be insecure.
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | latin1                     |
| character_set_connection | latin1                     |
| character_set_database   | latin1                     |
| character_set_filesystem | binary                     |
| character_set_results    | latin1                     |
| character_set_server     | latin1                     |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
pod "mysql-client" deleted
```

æ—¥æœ¬èªã‚’ç™»éŒ²ã§ãã‚‹ã‚ˆã†ã«charsetã‚’`utf8mb4`ã«å¤‰æ›´ã—ã¾ã™ã€‚`/etc/mysql/conf.d/charset.cnf`ã«æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚Œã°è‰¯ã„ã§ã™ã€‚

```
[mysqld]
character-set-server=utf8mb4
collation-server=utf8mb4_general_ci
[client]
default-character-set=utf8mb4
```

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ConfigMapã«æ ¼ç´ã—ã€ã‚³ãƒ³ãƒ†ãƒŠä¸Šã«ãƒã‚¦ãƒ³ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

`mysql-config.yml`ã‚’ä½œæˆã—ã¦ã€æ¬¡ã®å†…å®¹ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

```
apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-config
data:
  charset.cnf: |-
    [mysqld]
    character-set-server=utf8mb4
    collation-server=utf8mb4_general_ci
    [client]
    default-character-set=utf8mb4
```

ã“ã®manifestã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„ã€‚

```
kubectl apply -f mysql-config.yml 
```
å‡ºåŠ›çµæœ
```
configmap/mysql-config created
```

ã“ã®ConfigMapã‚’`/etc/mysql/conf.d/charset.cnf`ã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã‚ˆã†ã«ã€
`mysql.yml`ã‚’æ¬¡ã®å†…å®¹ã«æ›´æ–°ã—ã¦ãã ã•ã„ã€‚

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql
spec:
  # ...
  template:
    # ...
    spec:
      initContainers:
      # ...
      containers:
      - image: mysql:5.7
        name: mysql
        # ...
        volumeMounts:
        # ...
        # ã“ã“ã‹ã‚‰è¿½åŠ 
        - name: mysql-config
          mountPath: /etc/mysql/conf.d
          readOnly: true
        # ã“ã“ã¾ã§
      volumes:
      # ... 
      # ã“ã“ã‹ã‚‰è¿½åŠ 
      - name: mysql-config
        configMap:
          name: mysql-config
          items:
          - key: charset.cnf
            path: charset.cnf
      # ã“ã“ã¾ã§      
```

æ›´æ–°å†…å®¹ã‚’é©ç”¨ã—ã¦ãã ã•ã„ã€‚

```
kubectl apply -f mysql.yml
```
å‡ºåŠ›çµæœ
```
deployment.apps/mysql configured
```

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§å¤‰æ›´ãŒåæ˜ ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```
kubectl run -it --rm --image=mysql:5.7 --restart=Never mysql-client -- mysql -h mysql -u pksuser -ppkspassword -e 'show variables like "chara%";'
```
å‡ºåŠ›çµæœ
```
mysql: [Warning] Using a password on the command line interface can be insecure.
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | latin1                     |
| character_set_connection | latin1                     |
| character_set_database   | utf8mb4                    |
| character_set_filesystem | binary                     |
| character_set_results    | latin1                     |
| character_set_server     | utf8mb4                    |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
pod "mysql-client" deleted
```

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
```
kubectl run -it --rm --image=mysql:5.7 --restart=Never mysql-client -- mysql -h mysql -u pksuser -ppkspassword demo -e 'INSERT INTO hello(text) VALUES("ğŸº"); SELECT * FROM hello'
```
å‡ºåŠ›çµæœ
```
mysql: [Warning] Using a password on the command line interface can be insecure.
+----+--------------+
| id | text         |
+----+--------------+
|  1 | Hello World! |
|  2 | ğŸº         |
+----+--------------+
pod "mysql-client" deleted
```

ã“ã“ã¾ã§ã®`mysql.yml`ã‚’å†æ²ã—ã¾ã™ã€‚

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql
spec:
  selector:
    matchLabels:
      app: mysql
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: mysql
    spec:
      initContainers:
      - name: remove-lost-found
        image: busybox
        command:          
        - sh
        - -c
        - |
          rm -fr /var/lib/mysql/lost+found
        volumeMounts:
        - name: mysql-persistent-storage
          mountPath: /var/lib/mysql
      containers:
      - image: mysql:5.7
        name: mysql
        env:
        - name: MYSQL_DATABASE
          value: demo
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_ROOT_PASSWORD
        - name: MYSQL_USER
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_USER
        - name: MYSQL_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_PASSWORD
        ports:
        - containerPort: 3306
          name: mysql
        volumeMounts:
        - name: mysql-persistent-storage
          mountPath: /var/lib/mysql
        - name: mysql-config
          mountPath: /etc/mysql/conf.d
          readOnly: true
      volumes:
      - name: mysql-persistent-storage
        persistentVolumeClaim:
          claimName: mysql-pvc
      - name: mysql-config
        configMap:
          name: mysql-config
          items:
          - key: charset.cnf
            path: charset.cnf
```

ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã¯`---`ã§åŒºåˆ‡ã£ã¦ä¸€ã¤ã®YAMLã«ã¾ã¨ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Secretä»¥å¤–ã¯ä¸€ã¤ã«ã¾ã¨ã‚ãŸæ–¹ãŒç®¡ç†ã—ã‚„ã™ã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

`mysql-secret.yml`ä»¥å¤–ã‚’æ¬¡ã®ã‚ˆã†ã«1ã¤ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã«ã«ã¾ã¨ã‚ã‚‰ã‚Œã¾ã™ã€‚`mysql.yml`ã‚’ä½œæˆã—ã¦ã€æ¬¡ã®å†…å®¹ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pvc
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
---
apiVersion: v1
kind: Service
metadata:
  name: mysql
spec:
  ports:
  - port: 3306
  selector:
    app: mysql
  clusterIP: None
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-config
data:
  charset.cnf: |-
    [mysqld]
    character-set-server=utf8mb4
    collation-server=utf8mb4_general_ci
    [client]
    default-character-set=utf8mb4
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql
spec:
  selector:
    matchLabels:
      app: mysql
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: mysql
    spec:
      initContainers:
      - name: remove-lost-found
        image: busybox
        command:          
        - sh
        - -c
        - |
          rm -fr /var/lib/mysql/lost+found
        volumeMounts:
        - name: mysql-persistent-storage
          mountPath: /var/lib/mysql
      containers:
      - image: mysql:5.7
        name: mysql
        env:
        - name: MYSQL_DATABASE
          value: demo
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_ROOT_PASSWORD
        - name: MYSQL_USER
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_USER
        - name: MYSQL_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_PASSWORD
        ports:
        - containerPort: 3306
          name: mysql
        volumeMounts:
        - name: mysql-persistent-storage
          mountPath: /var/lib/mysql
        - name: mysql-config
          mountPath: /etc/mysql/conf.d
          readOnly: true
      volumes:
      - name: mysql-persistent-storage
        persistentVolumeClaim:
          claimName: mysql-pvc
      - name: mysql-config
        configMap:
          name: mysql-config
          items:
          - key: charset.cnf
            path: charset.cnf
```

`kubectl apply -f mysql.yml`ã‚’å®Ÿè¡Œã—ã¦ã‚‚å¤‰æ›´ã¯ãªã„ã®ã§ã€`unchanged`ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```
persistentvolumeclaim/mysql-pvc unchanged
service/mysql unchanged
configmap/mysql-config unchanged
deployment.apps/mysql unchanged
```

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰MySQLã«ã‚¢ã‚¯ã‚»ã‚¹

ä½œæˆã—ãŸMySQLã«å¯¾ã—ã¦`hello-pks`ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

ã¾ãšã€`hello`ãƒ†ãƒ¼ãƒ–ãƒ«ã¯Dropã—ã¦ãã ã•ã„ã€‚

```
kubectl run -it --rm --image=mysql:5.7 --restart=Never mysql-client -- mysql -h mysql -u pksuser -ppkspassword demo -e 'DROP TABLE hello;'
```

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã«å¯¾å¿œã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³(`0.0.5`)ã®`hello-pks`ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚
`hello-pks.yml`ã«æ¬¡ã«å†…å®¹ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

```yaml
kind: Service
apiVersion: v1
metadata:
  name: hello-pks
spec:
  type: LoadBalancer
  selector:
    app: hello-pks
  ports:
  - protocol: TCP
    port: 8080
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: hello-pks
spec:
  replicas: 2
  selector:
    matchLabels:
      app: hello-pks
  template:
    metadata:
      labels:
        app: hello-pks
    spec:
      containers:
      - image: making/hello-pks:0.0.5 # <--ãƒãƒ¼ã‚¸ãƒ§ãƒ³å¤‰æ›´
        name: hello-pks
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: mysql
        ## ã“ã“ã‹ã‚‰é‡è¦
        - name: SPRING_DATASOURCE_URL
          value: jdbc:mysql://mysql:3306/demo?useSSL=false
        - name: SPRING_DATASOURCE_USERNAME
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_USER
        - name: SPRING_DATASOURCE_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_PASSWORD
        ## ã“ã“ã¾ã§é‡è¦
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: NODE_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        readinessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 10
          timeoutSeconds: 3
          failureThreshold: 3
          periodSeconds: 5
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 20
          timeoutSeconds: 1
          periodSeconds: 10
          failureThreshold: 1
```

`SPRING_PROFILES_ACTIVE=mysql`ã¯MySQLç”¨ã®è¨­å®šã‚’å®šç¾©ã—ãŸ[`application-mysql.properties`](https://github.com/making/hello-pks/blob/0.0.5/src/main/resources/application-mysql.properties)ã‚’èª­ã¿è¾¼ã¾ã›ã‚‹ãŸã‚ã®è¨­å®šã§ã‚ã‚Šã€
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®è¨­å®šã§ã™ã€‚ã“ã®è¨­å®šã‚’è¡Œã‚ãªã„ã¨ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã‚ã‚‹H2ãŒä½¿ç”¨ã•ã‚Œã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒçµ‚äº†ã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ã‚‚æ®ç™ºã™ã‚‹ã‚ˆã†ã«ä½œã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

Kubernetesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸMySQLã«Spring Bootã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ä¸Šã§é‡è¦ãªã®ã¯ã€`SPRING_DATASOURCE_URL`ã€`SPRING_DATASOURCE_USERNAME`ã€`SPRING_DATASOURCE_PASSWORD`ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã§ã™ã€‚
MySQLã¯URLã¯å†…éƒ¨DNS(KubeDNS)ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯Secretã‹ã‚‰å–å¾—ã—ã¾ã™ã€‚ã“ã“ã§ã¯MySQLã®Podã«è¨­å®šã—ãŸSecretã¨åŒã˜ã‚‚ã®ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„ã€‚

```
kubectl apply -f hello-pks.yml
```
å‡ºåŠ›çµæœ
```
service/hello-pks created
deployment.apps/hello-pks created
```

```
kubectl get svc hello-pks 
```
å‡ºåŠ›çµæœä¾‹
```
NAME        TYPE           CLUSTER-IP      EXTERNAL-IP                                                                   PORT(S)          AGE
hello-pks   LoadBalancer   10.100.200.64   a6223ec55de1211e9812f06c9c16b7d6-177704515.ap-northeast-1.elb.amazonaws.com   8080:31222/TCP   9s
```

`EXTERNAL-IP`åˆ—ã®IPã¾ãŸã¯Hoståã‚’ç¢ºèªã—ã€`http://<EXTERNAL-IP>:8080`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚

![image](https://user-images.githubusercontent.com/106908/65439093-98e74c80-de61-11e9-8a3d-fc01eca8b11c.png)

"TWEETS"ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚

![image](https://user-images.githubusercontent.com/106908/65439133-a69cd200-de61-11e9-8bb9-005498aea6e1.png)

Nameã¨Tweetã‚’åŸ‹ã‚ã¦"SUBMIT"ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚MySQLã«TweetãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚

![image](https://user-images.githubusercontent.com/106908/65439328-f085b800-de61-11e9-9ee0-28b36650dd6f.png)

#### ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€ä½œæˆã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‚’ã¾ã¨ã‚ã¦å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚

```
kubectl delete -f mysql.yml -f mysql-secret.yml -f hello-pks.yml
```
å‡ºåŠ›çµæœ
```
persistentvolumeclaim "mysql-pvc" deleted
service "mysql" deleted
configmap "mysql-config" deleted
deployment.apps "mysql" deleted
secret "mysql-secret" deleted
service "hello-pks" deleted
deployment.apps "hello-pks" deleted
```

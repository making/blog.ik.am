---
title: HTTP/3に対応したcurlをHomebrewでインストールするメモ
tags: ["curl", "HTTP/3", "Homebrew"]
categories: ["Dev", "curl"]
---

手元のMacにインストールされている`curl` (8.4.0) はまだHTTP/3に対応していないので、HTTP/3に対応したcurlをインストールする。

手元の`curl`のバージョンは次の通り。

```
$ curl --version
curl 8.4.0 (x86_64-apple-darwin23.0) libcurl/8.4.0 (SecureTransport) LibreSSL/3.3.6 zlib/1.2.12 nghttp2/1.58.0
Release-Date: 2023-10-11
Protocols: dict file ftp ftps gopher gophers http https imap imaps ldap ldaps mqtt pop3 pop3s rtsp smb smbs smtp smtps telnet tftp
Features: alt-svc AsynchDNS GSS-API HSTS HTTP2 HTTPS-proxy IPv6 Kerberos Largefile libz MultiSSL NTLM NTLM_WB SPNEGO SSL threadsafe UnixSockets
```

CloudflareがFormulaを https://github.com/cloudflare/homebrew-cloudflare/blob/master/curl.rb を公開しているので、これを使用する。

インストール方法は次の通り。

```
brew remove -f curl
wget https://raw.githubusercontent.com/cloudflare/homebrew-cloudflare/master/curl.rb
brew install --formula --HEAD -s curl.rb
```

`PATH`を更新する。

```
echo 'export PATH="/opt/homebrew/opt/curl/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc
```

HTTP/3に対応した`curl`のversionに更新された。

```
$ curl --version
curl 8.8.0-DEV (aarch64-apple-darwin23.4.0) libcurl/8.8.0-DEV BoringSSL zlib/1.2.12 brotli/1.1.0 zstd/1.5.6 libidn2/2.3.7 libssh2/1.11.0 nghttp2/1.61.0 quiche/0.21.0 librtmp/2.3 OpenLDAP/2.6.7
Release-Date: [unreleased]
Protocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns ldap ldaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp
Features: alt-svc AsynchDNS brotli GSS-API HSTS HTTP2 HTTP3 HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM SPNEGO SSL threadsafe UnixSockets zstd
```

`--http3-only`オプションまたは`--http3`オプション(HTTP/3が対応していない場合はフォールバックする)をつけて`www.google.com`にアクセス。

```
$ curl -sI --http3-only https://www.google.com
HTTP/3 200 
content-type: text/html; charset=ISO-8859-1
content-security-policy-report-only: object-src 'none';base-uri 'self';script-src 'nonce-mzffTg1RRYtd4fK2wA9Onw' 'strict-dynamic' 'report-sample' 'unsafe-eval' 'unsafe-inline' https: http:;report-uri https://csp.withgoogle.com/csp/gws/other-hp
p3p: CP="This is not a P3P policy! See g.co/p3phelp for more info."
date: Thu, 16 May 2024 00:41:05 GMT
server: gws
x-xss-protection: 0
x-frame-options: SAMEORIGIN
expires: Thu, 16 May 2024 00:41:05 GMT
cache-control: private
set-cookie: 1P_JAR=2024-05-16-00; expires=Sat, 15-Jun-2024 00:41:05 GMT; path=/; domain=.google.com; Secure
set-cookie: AEC=AQTF6HxWGz7OkiPARw9ohGTXMWEspVI04c9tZ2gnEviM_FCsE7FZlqXFeg; expires=Tue, 12-Nov-2024 00:41:05 GMT; path=/; domain=.google.com; Secure; HttpOnly; SameSite=lax
set-cookie: NID=514=IWyHIU-3x8YTfhNMCVAqw9CMesEbX3Z5hbUhoTGpk12oquP6iuaXo0MuB7o7X5FusMvosGpuu0TThZ4Pu-r8gP-VByc4-ZsOqgOb10OWSe_asW1G2EK1Plc8Lf-Y5fr_OPyBQRhBwJzlEnrdueScVgGi1FwrMFN1SIRRMK4hGgE; expires=Fri, 15-Nov-2024 00:41:05 GMT; path=/; domain=.google.com; HttpOnly
alt-svc: h3=":443"; ma=2592000,h3-29=":443"; ma=2592000
```

`HTTP/3 200`で返った。
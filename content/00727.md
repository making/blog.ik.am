---
title: Tanzu Application Platformã«å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Spring Bootã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹éš›ã®Workaround
tags: ["Kubernetes", "Tanzu", "TAP", "Tanzu Build Service", "kpack", "Maven"]
categories: ["Dev", "CaaS", "Kubernetes", "TAP"]
---

TAPã«å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Spring Bootã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹éš›ã«ã„ãã¤ã‹å•é¡ŒãŒèµ·ãã‚‹ã®ã§ã€å›é¿ç­–ã‚’ãƒ¡ãƒ¢ã—ã¾ã™ã€‚


ä»Šå›ã¯ https://github.com/making/demo-download-view ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¾ã™ã€‚


ã“ã®ã‚¢ãƒ—ãƒªã¯Spring Boot **1.3** ã‚’ä½¿ç”¨ã—ã¦ã€7å¹´å‰ã«ä½œæˆã•ã‚Œã¾ã—ãŸã€‚

ã“ã®ã‚¢ãƒ—ãƒªã‚’ãã®ã¾ã¾TAPã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚


```
tanzu apps workload apply demo-download-view \
  --app demo-download-view \
  --git-repo https://github.com/making/demo-download-view \
  --git-branch master \
  --type web \
  --annotation autoscaling.knative.dev/minScale=1 \
  --build-env BP_JVM_VERSION=8 \
  -n demo \
  -y
```

ç™ºç”Ÿã™ã‚‹ã‚¨ãƒ©ãƒ¼ã‚’1ã¤1ã¤å¯¾å‡¦ã—ã¦ã„ãã¾ã™ã€‚

**ç›®æ¬¡**
<!-- toc -->


### MavenãŒå¤ã„ã“ã¨ã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

Build Serviceã«ã‚ˆã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆæ™‚ã«ã€ã¾ãšæ¬¡ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚


```
Compiled Application: Contributing to layer
  Executing mvnw --settings=/platform/bindings/settings-xml/settings.xml --batch-mode -Dmaven.test.skip=true --no-transfer-progress package
    Downloading https://repo1.maven.org/maven2/org/apache/maven/apache-maven/3.3.3/apache-maven-3.3.3-bin.zip
    ........................................................................................................................................................................................................................................................................................................................................................................................................................
    Unzipping /home/cnb/.m2/wrapper/dists/apache-maven-3.3.3-bin/3opbjp6rgl6qp7k2a6tljcpvgp/apache-maven-3.3.3-bin.zip to /home/cnb/.m2/wrapper/dists/apache-maven-3.3.3-bin/3opbjp6rgl6qp7k2a6tljcpvgp
    Set executable permissions for: /home/cnb/.m2/wrapper/dists/apache-maven-3.3.3-bin/3opbjp6rgl6qp7k2a6tljcpvgp/apache-maven-3.3.3/bin/mvn
    Unable to parse command line options: Unrecognized option: --no-transfer-progress
```

Maven Buildpackã¯mavenãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œæ™‚ã« `--no-transfer-progress` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ãƒ­ã‚°ã®å‡ºåŠ›ã‚’æŠ‘åˆ¶ã™ã‚‹ã®ã§ã™ãŒã€
ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯Maven 3.6.1ã§å°å…¥ã•ã‚Œã¾ã—ãŸã€‚ä»Šå›ã®ã‚¢ãƒ—ãƒªã«å«ã¾ã‚Œã‚‹Maven Wrapperã¯Mavenã‚’3.3.3ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã€ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€Maven WrapperãŒä½¿ç”¨ã™ã‚‹Mavenã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æœ€æ–°ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
mvn wrapper:wrapper
```

æ¬¡ã®ã‚ˆã†ã«ç‰¹å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™

```
mvn wrapper:wrapper -Dmaven=3.8.6
```


ä»Šå›ã¯æ¬¡ã®ã‚³ãƒŸãƒƒãƒˆã§Maven Wrapperã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚

https://github.com/making/demo-download-view/commit/25eac90254d3c728ec1c4b90740aff51495e434c

ã‚‚ã—ãã¯æ¬¡ã®ãƒ“ãƒ«ãƒ‰ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã€ `--no-transfer-progress` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ãªã„ã‚ˆã†ã«ã—ã¦ã‚‚è‰¯ã„ã§ã—ã‚‡ã†ã€‚

```
--build-env BP_MAVEN_BUILD_ARGUMENTS='-Dmaven.test.skip=true package' \
```

### Spring-Boot-LibãŒMANIFEST.MFã«å­˜åœ¨ã—ãªã„ã“ã¨ã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

Gitä¸Šã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã™ã‚‹ã¨ã€å†åº¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ä»Šåº¦ã¯æ¬¡ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

```
Paketo Buildpack for Spring Boot 5.19.0
  https://github.com/paketo-buildpacks/spring-boot
  Build Configuration:
    $BP_SPRING_CLOUD_BINDINGS_DISABLED   false  whether to contribute Spring Boot cloud bindings support
  Launch Configuration:
    $BPL_SPRING_CLOUD_BINDINGS_DISABLED  false  whether to auto-configure Spring Boot environment properties from bindings
    $BPL_SPRING_CLOUD_BINDINGS_ENABLED   true   Deprecated - whether to auto-configure Spring Boot environment properties from bindings

Paketo Buildpack for Spring Boot 5.19.0
  manifest does not container Spring-Boot-Lib
ERROR: failed to build: exit status 1
```

jarãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã®MANIFEST.MFã«`Spring-Boot-Lib`ãŒãªã„ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã§ã™ã€‚

æ¬¡ã®Buildpackã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ã¨ã€Buildpackã¯BOMã«dependenciesã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã«ã“ã®é …ç›®ã«è¨­å®šã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¦‹ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

* https://github.com/paketo-buildpacks/spring-boot/blob/v5.19.0/boot/build.go#L89


ã“ã®`Spring-Boot-Lib`ã¯Mavenã®å ´åˆã¯Spring Boot 1.4.0ã€Gradleã®å ´åˆã¯2.0.9ã‹ã‚‰å«ã¾ã‚ŒãŸã‚ˆã†ã§ã™ã€‚

* https://github.com/spring-projects/spring-boot/issues/5183
* https://github.com/spring-projects/spring-boot/issues/16068


ã‚µãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯æ¬¡ã®ã‚ˆã†ãªå€¤ãŒMANIFEST.MFã«è¨­å®šã•ã‚Œã¾ã™ã€‚

* https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot-tools/spring-boot-jarmode-layertools/src/test/resources/org/springframework/boot/jarmode/layertools/test-manifest.MF#L10 (jarã®å ´åˆ)
* https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot-tools/spring-boot-jarmode-layertools/src/test/resources/org/springframework/boot/jarmode/layertools/test-war-manifest.MF#L10 (warã®å ´åˆ)


ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ä½•ã‚‰ã‹ã®æ–¹æ³•ã§ã€MANIFEST.MFã«ã“ã®å€¤ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
MANIFST.MFã«å¯¾ã—ã¦ã¯Mavenã§ã¯maven-jar-pluginã‚’ä½¿ã£ã¦æ¬¡ã®ã‚ˆã†ã«ä»»æ„ã®é …ç›®ã‚’è¿½åŠ ã§ãã¾ã™ã€‚

```xml
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-jar-plugin</artifactId>
				<configuration>
					<archive>
						<manifestEntries>
							<Spring-Boot-Lib>lib/</Spring-Boot-Lib>
						</manifestEntries>
					</archive>
				</configuration>
			</plugin>
```

warãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ã‚‹å ´åˆã¯maven-jar-pluginã‚’maven-war-pluginã«å¤‰ãˆã¦ãã ã•ã„ã€‚
è¨­å®šã™ã¹ãå†…å®¹ã¯Spring Bootã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã€‚jarã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå¤‰ã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚


jarã‚„warã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ç¢ºèªã—ãŸã„å ´åˆã¯`zipinfo`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚

```
$ zipinfo target/demo-0.0.1-SNAPSHOT.jar 
Archive:  target/demo-0.0.1-SNAPSHOT.jar
Zip file size: 20306425 bytes, number of entries: 122
-rw----     2.0 fat        0 bX defN 22-Dec-22 11:25 META-INF/
-rw----     2.0 fat      477 bl defN 22-Dec-22 11:25 META-INF/MANIFEST.MF
drwxr-xr-x  1.0 unx        0 b- stor 22-Dec-22 11:25 templates/
drwxr-xr-x  1.0 unx        0 b- stor 22-Dec-22 11:25 com/
drwxr-xr-x  1.0 unx        0 b- stor 22-Dec-22 11:25 com/example/
-rw-r--r--  2.0 unx      419 bl defN 22-Dec-22 11:25 templates/index.html
-rw-r--r--  2.0 unx       15 bl defN 22-Dec-22 11:25 hello.txt
-rw-r--r--  2.0 unx      730 bl defN 22-Dec-22 11:25 com/example/DemoDownloadViewApplication.class
-rw-r--r--  2.0 unx      701 bl defN 22-Dec-22 11:25 com/example/HelloForm.class
-rw-r--r--  2.0 unx     1586 bl defN 22-Dec-22 11:25 com/example/HelloController.class
-rw-r--r--  2.0 unx     2112 bl defN 22-Dec-22 11:25 com/example/DownloadView.class
-rw-r--r--  2.0 unx        0 bl defN 22-Dec-22 11:25 application.properties
drwxr-xr-x  1.0 unx        0 b- stor 22-Dec-22 11:25 META-INF/maven/
drwxr-xr-x  1.0 unx        0 b- stor 22-Dec-22 11:25 META-INF/maven/com.example/
drwxr-xr-x  1.0 unx        0 b- stor 22-Dec-22 11:25 META-INF/maven/com.example/demo/
-rw-r--r--  2.0 unx     1913 bl defN 22-Dec-22 11:24 META-INF/maven/com.example/demo/pom.xml
-rw-r--r--  2.0 unx      109 bl defN 22-Dec-22 11:25 META-INF/maven/com.example/demo/pom.properties
-rw----     2.0 fat        0 bl defN 22-Dec-22 11:25 lib/
-rw----     1.0 fat   193581 b- stor 15-Nov-16 02:45 lib/spring-boot-devtools-1.3.0.RELEASE.jar
-rw----     1.0 fat   533592 b- stor 15-Nov-16 02:34 lib/spring-boot-1.3.0.RELEASE.jar
...
-rw----     1.0 fat  1077165 b- stor 15-Nov-15 08:03 lib/spring-core-4.2.3.RELEASE.jar
-rw----     2.0 fat        0 bl defN 22-Dec-22 11:25 org/
-rw----     2.0 fat        0 bl defN 22-Dec-22 11:25 org/springframework/
-rw----     2.0 fat        0 bl defN 22-Dec-22 11:25 org/springframework/boot/
-rw----     2.0 fat        0 bl defN 22-Dec-22 11:25 org/springframework/boot/loader/
-rw----     2.0 fat     1257 bl defN 15-Nov-16 02:31 org/springframework/boot/loader/LaunchedURLClassLoader$Java7LockProvider.class
...
-rw----     2.0 fat      884 bl defN 15-Nov-16 02:31 org/springframework/boot/loader/archive/ExplodedArchive$FileNotFoundURLConnection.class
-rw----     2.0 fat      192 bl defN 15-Nov-16 02:31 org/springframework/boot/loader/JavaAgentDetector.class
122 files, 20382587 bytes uncompressed, 20285023 bytes compressed:  0.5%
```

ä»Šå›ã¯æ¬¡ã®ã‚³ãƒŸãƒƒãƒˆã§pom.xmlã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚

https://github.com/making/demo-download-view/commit/e13e75a10560721e9f2c86563494bafb94dae8d1


### Spring-Boot-ClassesãŒMANIFEST.MFã«å­˜åœ¨ã—ãªã„ã“ã¨ã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

Gitä¸Šã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã™ã‚‹ã¨ã€å†åº¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ä»Šåº¦ã¯æ¬¡ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

```
Paketo Buildpack for Spring Boot 5.19.0
  https://github.com/paketo-buildpacks/spring-boot
  Build Configuration:
    $BP_SPRING_CLOUD_BINDINGS_DISABLED   false  whether to contribute Spring Boot cloud bindings support
  Launch Configuration:
    $BPL_SPRING_CLOUD_BINDINGS_DISABLED  false  whether to auto-configure Spring Boot environment properties from bindings
    $BPL_SPRING_CLOUD_BINDINGS_ENABLED   true   Deprecated - whether to auto-configure Spring Boot environment properties from bindings

Paketo Buildpack for Spring Boot 5.19.0
  manifest does not contain Spring-Boot-Classes
ERROR: failed to build: exit status 1
```

å…ˆã»ã©ã¨åŒæ§˜ã«jarãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã®MANIFEST.MFã«`Spring-Boot-Classes`ãŒãªã„ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã§ã™ã€‚


æ¬¡ã®Buildpackã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒ—ã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã«ã“ã®é …ç›®ã«è¨­å®šã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¦‹ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

* https://github.com/paketo-buildpacks/spring-boot/blob/v5.19.0/boot/build.go#L152


ã‚µãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯æ¬¡ã®ã‚ˆã†ãªå€¤ãŒMANIFEST.MFã«è¨­å®šã•ã‚Œã¾ã™ã€‚

* https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot-tools/spring-boot-jarmode-layertools/src/test/resources/org/springframework/boot/jarmode/layertools/test-manifest.MF#L9 (jarã®å ´åˆ)
* https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot-tools/spring-boot-jarmode-layertools/src/test/resources/org/springframework/boot/jarmode/layertools/test-war-manifest.MF#L9 (warã®å ´åˆ)


ä»Šå›ã‚‚maven-jar-plugin or maven-war-pluginã§ã“ã®é …ç›®ã‚’è¨­å®šã—ã¾ã™ã€‚


```xml
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-jar-plugin</artifactId>
				<configuration>
					<archive>
						<manifestEntries>
							<Spring-Boot-Lib>lib/</Spring-Boot-Lib>
							<Spring-Boot-Classes>.</Spring-Boot-Classes>							
						</manifestEntries>
					</archive>
				</configuration>
			</plugin>
```

ä»Šå›ã¯æ¬¡ã®ã‚³ãƒŸãƒƒãƒˆã§pom.xmlã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚

https://github.com/making/demo-download-view/commit/ae127b2bbad58f663573489cbe95f24ff165129e


### Spring Cloud Bindingsã«é–¢ã™ã‚‹ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼


Gitä¸Šã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã™ã‚‹ã¨ã€å†åº¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ä»Šåº¦ã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã—ã€ã‚¢ãƒ—ãƒªã®èµ·å‹•ãŒå§‹ã¾ã‚Šã¾ã—ãŸã€‚
ã—ã‹ã—ã€èµ·å‹•æ™‚ã«æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã€ã‚¢ãƒ—ãƒªã¯èµ·å‹•ã—ã¾ã›ã‚“ã€‚

```
java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.boot.loader.MainMethodRunner.run(MainMethodRunner.java:53)
	at java.lang.Thread.run(Thread.java:750)
Caused by: java.lang.IllegalArgumentException: Cannot instantiate interface org.springframework.context.ApplicationListener :  org.springframework.cloud.bindings.boot.BindingSpecificEnvironmentPostProcessor
	at org.springframework.boot.SpringApplication.getSpringFactoriesInstances(SpringApplication.java:396)
	at org.springframework.boot.SpringApplication.getSpringFactoriesInstances(SpringApplication.java:373)
	at org.springframework.boot.SpringApplication.initialize(SpringApplication.java:253)
	at org.springframework.boot.SpringApplication.<init>(SpringApplication.java:227)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1112)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1101)
	at com.example.DemoDownloadViewApplication.main(DemoDownloadViewApplication.java:10)
	... 6 more
Caused by: java.lang.ClassNotFoundException:  org.springframework.cloud.bindings.boot.BindingSpecificEnvironmentPostProcessor
	at java.net.URLClassLoader.findClass(URLClassLoader.java:387)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:418)
	at org.springframework.boot.loader.LaunchedURLClassLoader.doLoadClass(LaunchedURLClassLoader.java:166)
	at org.springframework.boot.loader.LaunchedURLClassLoader.loadClass(LaunchedURLClassLoader.java:130)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:351)
	at org.springframework.util.ClassUtils.forName(ClassUtils.java:250)
	at org.springframework.boot.SpringApplication.getSpringFactoriesInstances(SpringApplication.java:389)
	... 12 more
```

Spring Cloud Bindingsã«é–¢é€£ã™ã‚‹ã‚¨ãƒ©ãƒ¼ã§ã™ã€‚ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰æ™‚ã«è‡ªå‹•ã§è¿½åŠ ã•ã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ãŒã€Spring Bootã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã›ã„ã‹ã€ClassNotFoundExceptionãŒç™ºç”Ÿã—ã¦ã—ã¾ã„ã¾ã™ã€‚

Service Binidngã‚’ä½¿ã‚ãªã„å ´åˆã¯ã€Spring Cloud Bindingsã¯ãªãã¦ã‚‚è‰¯ã„ã®ã§ã€`--build-env BP_SPRING_CLOUD_BINDINGS_DISABLED=true`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ã€ãƒ“ãƒ«ãƒ‰æ™‚ã«Spring Cloud Bindingsã‚’ç„¡åŠ¹ã«ã—ã¾ã™ã€‚

æœ€çµ‚çš„ã«å®Ÿè¡Œã—ãŸã‚³ãƒãƒ³ãƒ‰ã¯æ¬¡ã§ã™ã€‚

```
tanzu apps workload apply demo-download-view \
  --app demo-download-view \
  --git-repo https://github.com/making/demo-download-view \
  --git-branch tap \
  --type web \
  --annotation autoscaling.knative.dev/minScale=1 \
  --build-env BP_JVM_VERSION=8 \
  --build-env BP_SPRING_CLOUD_BINDINGS_DISABLED=true \
  -n demo \
  -y
```



```
$ tanzu apps workload get -n demo demo-download-view 
ğŸ“¡ Overview
   name:   demo-download-view
   type:   web

ğŸ’¾ Source
   type:     git
   url:      https://github.com/making/demo-download-view
   branch:   tap

ğŸ“¦ Supply Chain
   name:   source-to-url

   RESOURCE           READY   HEALTHY   TIME   OUTPUT
   source-provider    True    True      42m    GitRepository/demo-download-view
   image-provider     True    True      101s   Image/demo-download-view
   config-provider    True    True      12m    PodIntent/demo-download-view
   app-config         True    True      12m    ConfigMap/demo-download-view
   service-bindings   True    True      12m    ConfigMap/demo-download-view-with-claims
   api-descriptors    True    True      12m    ConfigMap/demo-download-view-with-api-descriptors
   config-writer      True    True      81s    Runnable/demo-download-view-config-writer

ğŸšš Delivery
   name:   delivery-basic

   RESOURCE          READY   HEALTHY   TIME   OUTPUT
   source-provider   True    True      11m    ImageRepository/demo-download-view-delivery
   deployer          True    True      69s    App/demo-download-view

ğŸ’¬ Messages
   No messages found.

ğŸ›¶ Pods
   NAME                                                   READY   STATUS        RESTARTS        AGE
   demo-download-view-00001-deployment-76b5cc876c-t9clq   0/2     Terminating   7 (5m19s ago)   11m
   demo-download-view-00002-deployment-76dbf5f776-z7qvj   2/2     Running       0               71s
   demo-download-view-build-1-build-pod                   0/1     Init:Error    0               47m
   demo-download-view-build-2-build-pod                   0/1     Init:Error    0               42m
   demo-download-view-build-3-build-pod                   0/1     Init:Error    0               26m
   demo-download-view-build-4-build-pod                   0/1     Init:Error    0               16m
   demo-download-view-build-5-build-pod                   0/1     Completed     0               14m
   demo-download-view-build-6-build-pod                   0/1     Completed     0               2m29s
   demo-download-view-config-writer-d9l79-pod             0/1     Completed     0               92s
   demo-download-view-config-writer-f9kvp-pod             0/1     Completed     0               12m

ğŸš¢ Knative Services
   NAME                 READY   URL
   demo-download-view   Ready   https://demo-download-view-demo.127-0-0-1.sslip.io

To see logs: "tanzu apps workload tail demo-download-view --namespace demo"
```

ã“ã‚Œã§ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã€ã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚»ã§ãã¾ã—ãŸã€‚


```
$ curl -k "https://demo-download-view-demo.127-0-0-1.sslip.io/download?fileName=tap"    
Hello Download!
```

### Tanzu Build Serviceå˜ä½“ã®å ´åˆ

Tanzu Build Serviceã®ã¿ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ãŒç­‰ä¾¡ã§ã™ã€‚

```
kp image save demo-download-view \
  --git https://github.com/making/demo-download-view \
  --git-revision tap \
  --tag ghcr.io/making/demo-download-view \
  --env BP_JVM_VERSION=8 \
  --env BP_SPRING_CLOUD_BINDINGS_DISABLED=true \
  -n demo
```

---

å¤ã„Spring Bootã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«èµ·å› ã™ã‚‹buildpackã®å•é¡Œã‚’å›é¿ã—ã¾ã—ãŸã€‚

ã“ã®å›é¿ç­–ã‚’ä½¿ã†ã®ã§ã¯ãªãã€ã§ãã‚Œã°Spring Bootã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚
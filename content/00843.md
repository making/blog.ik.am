---
title: llama.cppでGemma 3 27Bを動かしてSpring AIからアクセスする
tags: ["llama.cpp", "OpenAI", "Machine Learning", "MPS", "Gemma", "Spring AI"]
categories: ["AI", "LLM", "llama.cpp"]
---

**目次**
<!-- toc -->


Googleが公開したGemma 3をllama-cppで動かし、 OpenAI API経由でアクセスします。

実行環境はこちらです
<img width="878" src="https://github.com/user-attachments/assets/c4a4076a-8a2f-4bf7-a8f1-7dfb005837d9" />

### llama-cppのインストール

```
brew install llama.cpp
```

次のバージョンで試します。

```
$ llama-server --version
version: 4897 (b3c9a656)
built with Apple clang version 16.0.0 (clang-1600.0.26.6) for arm64-apple-darwin24.2.0
```

### OpenAI API Serverの起動

実際にはGGUFフォーマット変換版の[ggml-org/gemma-3-27b-it-GGUF](https://huggingface.co/ggml-org/gemma-3-27b-it-GGUF)を使用します。初回はモデルがダウンロードされます(約15GB)。

```
llama-server -hf ggml-org/gemma-3-27b-it-GGUF --jinja --port 8000
```

> [!TIP] `--jinja`オプションは[Tool Calling](https://docs.spring.io/spring-ai/reference/api/tools.html)を使用するために必要です。

```
build: 4897 (b3c9a656) with Apple clang version 16.0.0 (clang-1600.0.26.6) for arm64-apple-darwin24.2.0
system info: n_threads = 12, n_threads_batch = 12, total_threads = 16

system_info: n_threads = 12 (n_threads_batch = 12) / 16 | Metal : EMBED_LIBRARY = 1 | CPU : NEON = 1 | ARM_FMA = 1 | FP16_VA = 1 | DOTPROD = 1 | LLAMAFILE = 1 | ACCELERATE = 1 | AARCH64_REPACK = 1 | 

main: HTTP server is listening, hostname: 127.0.0.1, port: 8000, http threads: 15
main: loading model
srv    load_model: loading model '/Users/toshiaki/Library/Caches/llama.cpp/ggml-org_gemma-3-27b-it-GGUF_gemma-3-27b-it-Q4_K_M.gguf'
common_download_file: previous metadata file found /Users/toshiaki/Library/Caches/llama.cpp/ggml-org_gemma-3-27b-it-GGUF_gemma-3-27b-it-Q4_K_M.gguf.json: {"etag":"\"0692be0ba5f82dfeb68c582e67fb0f8c-1000\"","lastModified":"Wed, 12 Mar 2025 09:33:19 GMT","url":"https://huggingface.co/ggml-org/gemma-3-27b-it-GGUF/resolve/main/gemma-3-27b-it-Q4_K_M.gguf"}
curl_perform_with_retry: Trying to download from https://huggingface.co/ggml-org/gemma-3-27b-it-GGUF/resolve/main/gemma-3-27b-it-Q4_K_M.gguf (attempt 1 of 3)...
llama_model_load_from_file_impl: using device Metal (Apple M4 Max) - 98303 MiB free
llama_model_loader: loaded meta data with 40 key-value pairs and 808 tensors from /Users/toshiaki/Library/Caches/llama.cpp/ggml-org_gemma-3-27b-it-GGUF_gemma-3-27b-it-Q4_K_M.gguf (version GGUF V3 (latest))
llama_model_loader: Dumping metadata keys/values. Note: KV overrides do not apply in this output.
llama_model_loader: - kv   0:                       general.architecture str              = gemma3
llama_model_loader: - kv   1:                               general.type str              = model
llama_model_loader: - kv   2:                               general.name str              = Gemma 3 27b It
llama_model_loader: - kv   3:                           general.finetune str              = it
llama_model_loader: - kv   4:                           general.basename str              = gemma-3
llama_model_loader: - kv   5:                         general.size_label str              = 27B
llama_model_loader: - kv   6:                            general.license str              = gemma
llama_model_loader: - kv   7:                   general.base_model.count u32              = 1
llama_model_loader: - kv   8:                  general.base_model.0.name str              = Gemma 3 27b Pt
llama_model_loader: - kv   9:          general.base_model.0.organization str              = Google
llama_model_loader: - kv  10:              general.base_model.0.repo_url str              = https://huggingface.co/google/gemma-3...
llama_model_loader: - kv  11:                               general.tags arr[str,1]       = ["image-text-to-text"]
llama_model_loader: - kv  12:                      gemma3.context_length u32              = 131072
llama_model_loader: - kv  13:                    gemma3.embedding_length u32              = 5376
llama_model_loader: - kv  14:                         gemma3.block_count u32              = 62
llama_model_loader: - kv  15:                 gemma3.feed_forward_length u32              = 21504
llama_model_loader: - kv  16:                gemma3.attention.head_count u32              = 32
llama_model_loader: - kv  17:    gemma3.attention.layer_norm_rms_epsilon f32              = 0.000001
llama_model_loader: - kv  18:                gemma3.attention.key_length u32              = 128
llama_model_loader: - kv  19:              gemma3.attention.value_length u32              = 128
llama_model_loader: - kv  20:                      gemma3.rope.freq_base f32              = 1000000.000000
llama_model_loader: - kv  21:            gemma3.attention.sliding_window u32              = 1024
llama_model_loader: - kv  22:             gemma3.attention.head_count_kv u32              = 16
llama_model_loader: - kv  23:                   gemma3.rope.scaling.type str              = linear
llama_model_loader: - kv  24:                 gemma3.rope.scaling.factor f32              = 8.000000
llama_model_loader: - kv  25:                       tokenizer.ggml.model str              = llama
llama_model_loader: - kv  26:                         tokenizer.ggml.pre str              = default
llama_model_loader: - kv  27:                      tokenizer.ggml.tokens arr[str,262144]  = ["<pad>", "<eos>", "<bos>", "<unk>", ...
llama_model_loader: - kv  28:                      tokenizer.ggml.scores arr[f32,262144]  = [-1000.000000, -1000.000000, -1000.00...
llama_model_loader: - kv  29:                  tokenizer.ggml.token_type arr[i32,262144]  = [3, 3, 3, 3, 3, 4, 3, 3, 3, 3, 3, 3, ...
llama_model_loader: - kv  30:                tokenizer.ggml.bos_token_id u32              = 2
llama_model_loader: - kv  31:                tokenizer.ggml.eos_token_id u32              = 1
llama_model_loader: - kv  32:            tokenizer.ggml.unknown_token_id u32              = 3
llama_model_loader: - kv  33:            tokenizer.ggml.padding_token_id u32              = 0
llama_model_loader: - kv  34:               tokenizer.ggml.add_bos_token bool             = true
llama_model_loader: - kv  35:               tokenizer.ggml.add_eos_token bool             = false
llama_model_loader: - kv  36:                    tokenizer.chat_template str              = {{ bos_token }}\n{%- if messages[0]['r...
llama_model_loader: - kv  37:            tokenizer.ggml.add_space_prefix bool             = false
llama_model_loader: - kv  38:               general.quantization_version u32              = 2
llama_model_loader: - kv  39:                          general.file_type u32              = 15
llama_model_loader: - type  f32:  373 tensors
llama_model_loader: - type q4_K:  374 tensors
llama_model_loader: - type q6_K:   61 tensors
print_info: file format = GGUF V3 (latest)
print_info: file type   = Q4_K - Medium
print_info: file size   = 15.40 GiB (4.90 BPW) 
load: special_eos_id is not in special_eog_ids - the tokenizer config may be incorrect
load: special tokens cache size = 6414
load: token to piece cache size = 1.9446 MB
print_info: arch             = gemma3
print_info: vocab_only       = 0
print_info: n_ctx_train      = 131072
print_info: n_embd           = 5376
print_info: n_layer          = 62
print_info: n_head           = 32
print_info: n_head_kv        = 16
print_info: n_rot            = 128
print_info: n_swa            = 1024
print_info: n_swa_pattern    = 6
print_info: n_embd_head_k    = 128
print_info: n_embd_head_v    = 128
print_info: n_gqa            = 2
print_info: n_embd_k_gqa     = 2048
print_info: n_embd_v_gqa     = 2048
print_info: f_norm_eps       = 0.0e+00
print_info: f_norm_rms_eps   = 1.0e-06
print_info: f_clamp_kqv      = 0.0e+00
print_info: f_max_alibi_bias = 0.0e+00
print_info: f_logit_scale    = 0.0e+00
print_info: f_attn_scale     = 7.7e-02
print_info: n_ff             = 21504
print_info: n_expert         = 0
print_info: n_expert_used    = 0
print_info: causal attn      = 1
print_info: pooling type     = 0
print_info: rope type        = 2
print_info: rope scaling     = linear
print_info: freq_base_train  = 1000000.0
print_info: freq_scale_train = 0.125
print_info: n_ctx_orig_yarn  = 131072
print_info: rope_finetuned   = unknown
print_info: ssm_d_conv       = 0
print_info: ssm_d_inner      = 0
print_info: ssm_d_state      = 0
print_info: ssm_dt_rank      = 0
print_info: ssm_dt_b_c_rms   = 0
print_info: model type       = 27B
print_info: model params     = 27.01 B
print_info: general.name     = Gemma 3 27b It
print_info: vocab type       = SPM
print_info: n_vocab          = 262144
print_info: n_merges         = 0
print_info: BOS token        = 2 '<bos>'
print_info: EOS token        = 1 '<eos>'
print_info: EOT token        = 106 '<end_of_turn>'
print_info: UNK token        = 3 '<unk>'
print_info: PAD token        = 0 '<pad>'
print_info: LF token         = 248 '<0x0A>'
print_info: EOG token        = 1 '<eos>'
print_info: EOG token        = 106 '<end_of_turn>'
print_info: max token length = 48
load_tensors: loading model tensors, this can take a while... (mmap = true)
load_tensors: offloading 62 repeating layers to GPU
load_tensors: offloading output layer to GPU
load_tensors: offloaded 63/63 layers to GPU
load_tensors: Metal_Mapped model buffer size = 15773.63 MiB
load_tensors:   CPU_Mapped model buffer size =  1102.50 MiB
.........................................................................................
llama_context: constructing llama_context
llama_context: n_seq_max     = 1
llama_context: n_ctx         = 4096
llama_context: n_ctx_per_seq = 4096
llama_context: n_batch       = 2048
llama_context: n_ubatch      = 512
llama_context: causal_attn   = 1
llama_context: flash_attn    = 0
llama_context: freq_base     = 1000000.0
llama_context: freq_scale    = 0.125
llama_context: n_ctx_per_seq (4096) < n_ctx_train (131072) -- the full capacity of the model will not be utilized
ggml_metal_init: allocating
ggml_metal_init: found device: Apple M4 Max
ggml_metal_init: picking default device: Apple M4 Max
ggml_metal_load_library: using embedded metal library
ggml_metal_init: GPU name:   Apple M4 Max
ggml_metal_init: GPU family: MTLGPUFamilyApple9  (1009)
ggml_metal_init: GPU family: MTLGPUFamilyCommon3 (3003)
ggml_metal_init: GPU family: MTLGPUFamilyMetal3  (5001)
ggml_metal_init: simdgroup reduction   = true
ggml_metal_init: simdgroup matrix mul. = true
ggml_metal_init: has residency sets    = true
ggml_metal_init: has bfloat            = true
ggml_metal_init: use bfloat            = false
ggml_metal_init: hasUnifiedMemory      = true
ggml_metal_init: recommendedMaxWorkingSetSize  = 103079.22 MB
ggml_metal_init: skipping kernel_get_rows_bf16                     (not supported)
ggml_metal_init: skipping kernel_mul_mv_bf16_f32                   (not supported)
ggml_metal_init: skipping kernel_mul_mv_bf16_f32_1row              (not supported)
ggml_metal_init: skipping kernel_mul_mv_bf16_f32_l4                (not supported)
ggml_metal_init: skipping kernel_mul_mv_bf16_bf16                  (not supported)
ggml_metal_init: skipping kernel_mul_mv_id_bf16_f32                (not supported)
ggml_metal_init: skipping kernel_mul_mm_bf16_f32                   (not supported)
ggml_metal_init: skipping kernel_mul_mm_id_bf16_f32                (not supported)
ggml_metal_init: skipping kernel_flash_attn_ext_bf16_h64           (not supported)
ggml_metal_init: skipping kernel_flash_attn_ext_bf16_h80           (not supported)
ggml_metal_init: skipping kernel_flash_attn_ext_bf16_h96           (not supported)
ggml_metal_init: skipping kernel_flash_attn_ext_bf16_h112          (not supported)
ggml_metal_init: skipping kernel_flash_attn_ext_bf16_h128          (not supported)
ggml_metal_init: skipping kernel_flash_attn_ext_bf16_h256          (not supported)
ggml_metal_init: skipping kernel_flash_attn_ext_vec_bf16_h128      (not supported)
ggml_metal_init: skipping kernel_flash_attn_ext_vec_bf16_h256      (not supported)
ggml_metal_init: skipping kernel_cpy_f32_bf16                      (not supported)
ggml_metal_init: skipping kernel_cpy_bf16_f32                      (not supported)
ggml_metal_init: skipping kernel_cpy_bf16_bf16                     (not supported)
llama_context:        CPU  output buffer size =     1.00 MiB
init: kv_size = 4096, offload = 1, type_k = 'f16', type_v = 'f16', n_layer = 62, can_shift = 1
init:      Metal KV buffer size =  1984.00 MiB
llama_context: KV self size  = 1984.00 MiB, K (f16):  992.00 MiB, V (f16):  992.00 MiB
llama_context:      Metal compute buffer size =   535.02 MiB
llama_context:        CPU compute buffer size =    26.51 MiB
llama_context: graph nodes  = 2487
llama_context: graph splits = 2
common_init_from_params: setting dry_penalty_last_n to ctx_size = 4096
common_init_from_params: warming up the model with an empty run - please wait ... (--no-warmup to disable)
srv          init: initializing slots, n_slots = 1
slot         init: id  0 | task -1 | new slot n_ctx_slot = 4096
main: model loaded
main: chat template, chat_template: {{ bos_token }}
{%- if messages[0]['role'] == 'system' -%}
    {%- if messages[0]['content'] is string -%}
        {%- set first_user_prefix = messages[0]['content'] + '

' -%}
    {%- else -%}
        {%- set first_user_prefix = messages[0]['content'][0]['text'] + '

' -%}
    {%- endif -%}
    {%- set loop_messages = messages[1:] -%}
{%- else -%}
    {%- set first_user_prefix = "" -%}
    {%- set loop_messages = messages -%}
{%- endif -%}
{%- for message in loop_messages -%}
    {%- if (message['role'] == 'user') != (loop.index0 % 2 == 0) -%}
        {{ raise_exception("Conversation roles must alternate user/assistant/user/assistant/...") }}
    {%- endif -%}
    {%- if (message['role'] == 'assistant') -%}
        {%- set role = "model" -%}
    {%- else -%}
        {%- set role = message['role'] -%}
    {%- endif -%}
    {{ '<start_of_turn>' + role + '
' + (first_user_prefix if loop.first else "") }}
    {%- if message['content'] is string -%}
        {{ message['content'] | trim }}
    {%- elif message['content'] is iterable -%}
        {%- for item in message['content'] -%}
            {%- if item['type'] == 'image' -%}
                {{ '<start_of_image>' }}
            {%- elif item['type'] == 'text' -%}
                {{ item['text'] | trim }}
            {%- endif -%}
        {%- endfor -%}
    {%- else -%}
        {{ raise_exception("Invalid content type") }}
    {%- endif -%}
    {{ '<end_of_turn>
' }}
{%- endfor -%}
{%- if add_generation_prompt -%}
    {{'<start_of_turn>model
'}}
{%- endif -%}
, example_format: '<start_of_turn>user
You are a helpful assistant

Hello<end_of_turn>
<start_of_turn>model
Hi there<end_of_turn>
<start_of_turn>user
How are you?<end_of_turn>
<start_of_turn>model
'
main: server is listening on http://127.0.0.1:8000 - starting the main loop
srv  update_slots: all slots are idle
```

簡易UIにアクセスします。

<img width="1024" alt="image" src="https://github.com/user-attachments/assets/66f598f0-0fa0-4b07-85d5-7ef992e7e52d">

次のプロンプトをUIに貼り付けてSubmitします。

```
A～Dの中で3人は正直者で、1人が嘘つきです。嘘つきはだれでしょう？

A：Dは嘘つきだ。
B：私は嘘をついていない。
C：Aは嘘をついていない。
D：Bは嘘つきだ。
```

![Image](https://github.com/user-attachments/assets/0e159f8e-100e-43b9-bf2a-9c8b5464eb4c)

はい、Dが正解です。

> [!TIP] 出力結果に揺れがあったのでtemperatureを0に設定しました。


次のプロンプトは[2012年東大入試 数学(文科) 第1問](https://toudainyuushi.com/wp-content/uploads/2018/08/12-2.pdf)です。UIに貼り付けてSubmitします。

```
座標平面上の点 (x, y) が次の方程式を満たす。 2x² + 4xy + 3y² + 4x + 5y - 4 = 0 このとき、x のとりうる最大の値を求めよ。
```

正解は`(-2+5√6)/4`です。

![Image](https://github.com/user-attachments/assets/079ae2af-f838-4050-a2e2-36991d9c1c5e)

UIで試した内容もOpenAI APIに対して、curlでもアクセスします。


```bash
curl -s http://localhost:8000/v1/chat/completions \
  --json '{
    "messages": [
      {"role": "user", "content": "A～Dの中で3人は正直者で、1人が嘘つきです。嘘つきはだれでしょう？\n\nA：Dは嘘つきだ。\nB：私は嘘をついていない。\nC：Aは嘘をついていない。\nD：Bは嘘つきだ。\n"}
    ], "temperature": 0
  }' | jq .
```

次のJSONが返ります。

```json
{
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "この問題は、論理的に考えて嘘つきを特定する必要があります。\n\n**1. 矛盾の可能性を探る**\n\n*   もしAが正直者なら、Dは嘘つきです。\n*   もしBが正直者なら、Bは嘘をついていません。\n*   もしCが正直者なら、Aは嘘をついていません。\n*   もしDが正直者なら、Bは嘘つきです。\n\n**2. 仮定と検証**\n\nそれぞれの人物が嘘つきであると仮定し、矛盾が生じるかどうかを検証します。\n\n*   **Aが嘘つきの場合:** Aの証言「Dは嘘つきだ」は嘘なので、Dは正直者です。この場合、Dの証言「Bは嘘つきだ」も真実となり、Bは嘘つきです。しかし、正直者が3人という条件に合致しません（Aが嘘つき、Bが嘘つき、Dが正直者、Cが不明）。\n*   **Bが嘘つきの場合:** Bの証言「私は嘘をついていない」は嘘なので、Bは嘘をついています。この場合、A、C、Dは正直者である可能性があります。Aの証言「Dは嘘つきだ」が真実なら、Dは嘘つきとなり矛盾します。\n*   **Cが嘘つきの場合:** Cの証言「Aは嘘をついていない」は嘘なので、Aは嘘つきです。Aの証言「Dは嘘つきだ」が真実なら、Dは嘘つきとなり、正直者が2人（AとDが嘘つき）となり矛盾します。\n*   **Dが嘘つきの場合:** Dの証言「Bは嘘つきだ」は嘘なので、Bは正直者です。Aの証言「Dは嘘つきだ」が真実となり、Cの証言「Aは嘘をついていない」も真実となります。この場合、A、B、Cが正直者で、Dが嘘つきとなり、条件に合致します。\n\n**3. 結論**\n\n上記の検証から、**Dが嘘つき**であると特定できます。"
      }
    }
  ],
  "created": 1742193118,
  "model": "gpt-3.5-turbo",
  "system_fingerprint": "b4897-b3c9a656",
  "object": "chat.completion",
  "usage": {
    "completion_tokens": 459,
    "prompt_tokens": 69,
    "total_tokens": 528
  },
  "id": "chatcmpl-jvmZxpPmNZA3CFBA5MpxN4Unt1jyE1Ot",
  "timings": {
    "prompt_n": 65,
    "prompt_ms": 488.227,
    "prompt_per_token_ms": 7.511184615384615,
    "prompt_per_second": 133.13479180790904,
    "predicted_n": 459,
    "predicted_ms": 22500.929,
    "predicted_per_token_ms": 49.02163180827887,
    "predicted_per_second": 20.399157741442586
  }
}
```

もう一件。

```bash
curl -s http://localhost:8000/v1/chat/completions \
  --json '{
   "messages": [
      {"role": "user", "content": "座標平面上の点 (x, y) が次の方程式を満たす。 2x² + 4xy + 3y² + 4x + 5y - 4 = 0 このとき、x のとりうる最大の値を求めよ。"}
   ]
 }' | jq .
```

次のJSONが返ります。

```json
{
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "与えられた方程式は\n$$2x^2 + 4xy + 3y^2 + 4x + 5y - 4 = 0$$\nこの方程式を $y$ についての二次方程式とみなして解く。\n$$3y^2 + (4x+5)y + (2x^2+4x-4) = 0$$\nこの二次方程式が実数解を持つためには、判別式が非負でなければならない。\n$$D = (4x+5)^2 - 4(3)(2x^2+4x-4) \\ge 0$$\n$$16x^2 + 40x + 25 - 24x^2 - 48x + 48 \\ge 0$$\n$$-8x^2 - 8x + 73 \\ge 0$$\n$$8x^2 + 8x - 73 \\le 0$$\nこの二次不等式を解くために、二次方程式 $8x^2 + 8x - 73 = 0$ の解を求める。\n$$x = \\frac{-8 \\pm \\sqrt{8^2 - 4(8)(-73)}}{2(8)} = \\frac{-8 \\pm \\sqrt{64 + 2336}}{16} = \\frac{-8 \\pm \\sqrt{2400}}{16} = \\frac{-8 \\pm 20\\sqrt{6}}{16} = \\frac{-2 \\pm 5\\sqrt{6}}{4}$$\nよって、\n$$\\frac{-2 - 5\\sqrt{6}}{4} \\le x \\le \\frac{-2 + 5\\sqrt{6}}{4}$$\n$x$ の最大値は $\\frac{-2 + 5\\sqrt{6}}{4}$ である。\n\n$x$ の最大値を求める。\n$$x_{max} = \\frac{-2 + 5\\sqrt{6}}{4}$$\n$\\sqrt{6} \\approx 2.449$ であるから、\n$$x_{max} \\approx \\frac{-2 + 5(2.449)}{4} = \\frac{-2 + 12.245}{4} = \\frac{10.245}{4} \\approx 2.561$$\n\nしたがって、x のとりうる最大の値は $\\frac{-2 + 5\\sqrt{6}}{4}$ である。\n\nFinal Answer: The final answer is $\\boxed{\\frac{-2+5\\sqrt{6}}{4}}$"
      }
    }
  ],
  "created": 1742193577,
  "model": "gpt-3.5-turbo",
  "system_fingerprint": "b4897-b3c9a656",
  "object": "chat.completion",
  "usage": {
    "completion_tokens": 571,
    "prompt_tokens": 64,
    "total_tokens": 635
  },
  "id": "chatcmpl-1QirJwNtM0OpCA9asKhgkquN3F0g6VOv",
  "timings": {
    "prompt_n": 60,
    "prompt_ms": 356.042,
    "prompt_per_token_ms": 5.934033333333333,
    "prompt_per_second": 168.51944433521888,
    "predicted_n": 571,
    "predicted_ms": 28415.924,
    "predicted_per_token_ms": 49.76519089316987,
    "predicted_per_second": 20.094366806442757
  }
}
```

#### Spring AIでアクセス

[Spring AI](https://docs.spring.io/spring-ai/reference/api/chat/openai-chat.html)を使ったアプリからアクセスしてみます。
OpenAI互換なので、Spring AIの[OpenAI用のChat Client](https://docs.spring.io/spring-ai/reference/api/clients/openai-chat.html)が利用できます。

サンプルアプリはこちらです。<br>
https://github.com/making/hello-spring-ai

```
git clone https://github.com/making/hello-spring-ai
cd hello-spring-ai
./mvnw clean package -DskipTests=true
java -jar target/hello-spring-ai-0.0.1-SNAPSHOT.jar --spring.ai.openai.base-url=http://localhost:8000 --spring.ai.openai.api-key=dummy
```

同じプロンプトを送ります。

```bash
$ curl localhost:8080 -H "Content-Type: text/plain" -d "A～Dの中で3人は正直者で、1人が嘘つきです。嘘つきはだれでしょう？\n\nA：Dは嘘つきだ。\nB：私は嘘をついていない。\nC：Aは嘘をついていない。\nD：Bは嘘つきだ。\n"

data:この問題は、論理的に考えて嘘つきを特定する必要があります。

data:
data:
data:**考え方**
data:
data:*   正直者は真実を言い、嘘つきは嘘をつきます。

data:
data:*   矛盾する発言は、嘘つきの発言である可能性が高いです。

data:
data:
data:**各発言の検討**
data:
data:*   **A：Dは嘘つきだ。

data:**
data:*   **B：私は嘘をついていない。

data:**
data:*   **C：Aは嘘をついていない。

data:**
data:*   **D：Bは嘘つきだ。

data:**
data:
data:**場合分け**
data:
data:1.

data:  **Aが嘘つきの場合:**
data:    *   Aの嘘なので、Dは嘘つきではありません。

data:つまり、Dは正直者です。

data:
data:    *   Dが正直者なので、Dの発言「Bは嘘つきだ」は真実です。

data:
data:    *   Bは嘘つきなので、Bの発言「私は嘘をついていない」は嘘です。

data:
data:    *   Cの発言「Aは嘘をついていない」は嘘なので、Cは嘘つきです。

data:
data:    *   この場合、AとCが嘘つきになり、正直者が2人しかいないので矛盾します。

data:
data:
data:2.

data:  **Bが嘘つきの場合:**
data:    *   Bの嘘なので、Bは嘘をついています。

data:
data:    *   Dの発言「Bは嘘つきだ」は真実なので、Dは正直者です。

data:
data:    *   Aの発言「Dは嘘つきだ」は嘘なので、Aは嘘つきです。

data:
data:    *   Cの発言「Aは嘘をついていない」は嘘なので、Cは嘘つきです。

data:
data:    *   この場合、A、B、Cが嘘つきになり、正直者が1人しかいないので矛盾します。

data:
data:
data:3.

data:  **Cが嘘つきの場合:**
data:    *   Cの嘘なので、Aは嘘つきです。

data:
data:    *   Aが嘘つきなので、Aの発言「Dは嘘つきだ」は嘘です。

data:つまり、Dは正直者です。

data:
data:    *   Dが正直者なので、Dの発言「Bは嘘つきだ」は真実です。

data:
data:    *   Bは嘘つきなので、Bの発言「私は嘘をついていない」は嘘です。

data:
data:    *   この場合、A、B、Cが嘘つきになり、正直者が1人しかいないので矛盾します。

data:
data:
data:4.

data:  **Dが嘘つきの場合:**
data:    *   Dの嘘なので、Bは嘘つきではありません。

data:つまり、Bは正直者です。

data:
data:    *   Bが正直者なので、Bの発言「私は嘘をついていない」は真実です。

data:
data:    *   Aの発言「Dは嘘つきだ」は真実なので、Aは正直者です。

data:
data:    *   Cの発言「Aは嘘をついていない」は真実なので、Cは正直者です。

data:
data:    *   この場合、Dだけが嘘つきで、A、B、Cが正直者となり、条件に合致します。

data:
data:
data:**結論**
data:
data:したがって、嘘つきは**D**です。
```

もう一件。

```bash
$ curl localhost:8080 -H "Content-Type: text/plain" -d "座標平面上の点 (x, y) が次の方程式を満たす。 2x² + 4xy + 3y² + 4x + 5y - 4 = 0 このとき、x のとりうる最大の値を求めよ。"

data:与えられた方程式は、
data:$$2x^2 + 4xy + 3y^2 + 4x + 5y - 4 = 0$$
data:この方程式を $y$ についての二次方程式と見て、実数解が存在するための条件を考えます。

data:
data:$$3y^2 + (4x+5)y + (2x^2+4x-4) = 0$$
data:この二次方程式が実数解を持つための判別式 $D$ は、
data:$$D = (4x+5)^2 - 4(3)(2x^2+4x-4) \ge 0$$
data:展開して整理すると、
data:$$16x^2 + 40x + 25 - 24x^2 - 48x + 48 \ge 0$$
data:$$-8x^2 - 8x + 73 \ge 0$$
data:$$8x^2 + 8x - 73 \le 0$$
data:この二次不等式を解くために、二次方程式 $8x^2 + 8x - 73 = 0$ の解を求めます。

data:
data:解の公式より、
data:$$x = \frac{-8 \pm \sqrt{8^2 - 4(8)(-73)}}{2(8)} = \frac{-8 \pm \sqrt{64 + 2336}}{16} = \frac{-8 \pm \sqrt{2400}}{16} = \frac{-8 \pm 20\sqrt{6}}{16} = \frac{-2 \pm 5\sqrt{6}}{4}$$
data:したがって、
data:$$x = \frac{-2 - 5\sqrt{6}}{4} \approx \frac{-2 - 5(2.

data:449)}{4} \approx \frac{-2 - 12.

data:245}{4} \approx \frac{-14.

data:245}{4} \approx -3.

data:561$$
data:$$x = \frac{-2 + 5\sqrt{6}}{4} \approx \frac{-2 + 5(2.

data:449)}{4} \approx \frac{-2 + 12.

data:245}{4} \approx \frac{10.

data:245}{4} \approx 2.

data:561$$
data:$8x^2 + 8x - 73 \le 0$ を満たす $x$ の範囲は、
data:$$\frac{-2 - 5\sqrt{6}}{4} \le x \le \frac{-2 + 5\sqrt{6}}{4}$$
data:したがって、$x$ の最大値は $\frac{-2 + 5\sqrt{6}}{4}$ です。

data:
data:
data:Final Answer: The final answer is $\boxed{\frac{-2+5\sqrt{6}}{4}}$
```

---

なかなか使えそうです。
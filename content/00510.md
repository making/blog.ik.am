---
title: Spring WebFlux.fn„Éè„É≥„Ç∫„Ç™„É≥ - X. GraalVM„ÅÆSubstrateVM„ÅßNative Image„Å´„Ç≥„É≥„Éë„Ç§„É´
tags: ["Spring WebFlux.fn Handson", "Reactor", "Reactor Netty", "Netty", "Spring 5", "Spring WebFlux", "Spring Boot", "Java", "Cloud Foundry", "Pivotal Web Services", "Pivotal Cloud Foundry", "GraalVM"]
categories: ["Programming", "Java", "org", "springframework", "web", "reactive"]
updated: 1970-01-01T09:00:00+09:00
---

Êú¨„Éè„É≥„Ç∫„Ç™„É≥„Åß„ÄÅÊ¨°„ÅÆÂõ≥„ÅÆ„Çà„ÅÜ„Å™Á∞°ÊòìÂÆ∂Ë®àÁ∞ø„ÅÆAPI„Çµ„Éº„Éê„Éº„ÇíSpring WebFlux.fn„Çí‰Ωø„Å£„Å¶ÂÆüË£Ö„Åó„Åæ„Åô„ÄÇ
„ÅÇ„Åà„Å¶Spring Boot„ÇÇDependency Injection„ÇÇ‰Ωø„Çè„Å™„ÅÑ„Ç∑„É≥„Éó„É´„Å™Web„Ç¢„Éó„É™„Å®„Åó„Å¶ÂÆüË£Ö„Åó„Åæ„Åô„ÄÇ

**„Éè„É≥„Ç∫„Ç™„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ**

1. [„ÅØ„Åò„ÇÅ„Å´](/entries/500)
1. [Á∞°ÊòìÂÆ∂Ë®àÁ∞øMoneyger„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆ‰ΩúÊàê](/entries/501)
1. [YAVI„Å´„Çà„ÇãValidation„ÅÆÂÆüË£Ö](/entries/502)
1. [R2DBC„Å´„Çà„Çã„Éá„Éº„Çø„Éô„Éº„Çπ„Ç¢„ÇØ„Çª„Çπ](/entries/503)
1. [Web UI„ÅÆËøΩÂä†](/entries/504)
1. [‰æãÂ§ñ„Éè„É≥„Éâ„É™„É≥„Ç∞„ÅÆÊîπÂñÑ](/entries/505)
1. [ÂèéÂÖ•API„ÅÆÂÆüË£Ö](/entries/506)
1. [Spring Boot„Ç¢„Éó„É™„Å´Â§âÊèõ](/entries/507)
1. [GraalVM„ÅÆSubstrateVM„ÅßNative Image„Å´„Ç≥„É≥„Éë„Ç§„É´](/entries/510) üëà

> „Åì„ÅÆÁ´†„Åß„ÅØSpring Boot„Ç¢„Éó„É™„Å´**Â§âÊèõÂâç**„ÅÆÁä∂ÊÖã„ÅßË°å„Å™„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

„Åã„Å™„Çä„ÉÅ„É£„É¨„É≥„Ç∏„É≥„Ç∞„Åß„Åô„Åå„ÄÅ„Åì„Åì„Åæ„Åß‰Ωú„Å£„Åü„Ç¢„Éó„É™„ÇíGraalVM„ÅÆSubstrateVM„ÅßNative Image„Å´„Ç≥„É≥„Éë„Ç§„É´„Åó„Å¶„Åø„Åæ„Åô„ÄÇ

> ‚ö†Ô∏è 2019-09-05ÊôÇÁÇπ„Åß„ÄÅGraalVM Version 19.2.0 CE„ÅßÂãï‰ΩúÁ¢∫Ë™ç„Åó„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅ
> ‰ªäÂ∫¶„ÇÇÂãï‰Ωú„Åô„Çã‰øùË®º„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ"„Å®„Çä„ÅÇ„Åà„ÅöÂãï„ÅÑ„Åü"„É¨„Éô„É´„ÅÆÂÜÖÂÆπ„Å™„ÅÆ„Åß„ÅÇ„Åæ„Çä‰ø°Áî®„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ

**ÁõÆÊ¨°**
<!-- toc -->

### App.java„ÅÆ‰øÆÊ≠£

`Jackson2ObjectMapperBuilder`„Éá„Éï„Ç©„É´„Éà„Åß„ÅØ‰ª£Ë°®ÁöÑ„Å™`com.fasterxml.jackson.databind.Module`„Åå„ÇØ„É©„Çπ„Éë„Çπ‰∏ä„Å´„ÅÑ„Çã„Å®Ëá™Âãï„ÅßÁôªÈå≤„Åô„Çã„ÄÇ
„É™„Éï„É¨„ÇØ„Ç∑„Éß„É≥„Çí‰Ωø„Å£„Å¶„ÉÅ„Çß„ÉÉ„ÇØ„Çí„Åó„Å¶„Åä„Çä„ÄÅNative Image„Åß„ÅØ„Éá„Éï„Ç©„É´„Éà„Åß„ÅØÁÑ°Ë¶ñ„Åï„Çå„Åæ„Åô„ÄÇ
‰ªäÂõû„ÅØ`com.fasterxml.jackson.datatype.jsr310.JavaTimeModule`„Çí‰ΩøÁî®„Åó„Åü„ÅÑ„Å†„Åë„Å™„ÅÆ„Åß„ÄÅ`modules`„É°„ÇΩ„ÉÉ„Éâ„ÅßÊòéÁ§∫ÁöÑ„Å´ÁôªÈå≤„Åó„Åæ„Åô„ÄÇ

```java
    public static HandlerStrategies handlerStrategies() {
        return HandlerStrategies.empty()
            .codecs(configure -> {
                configure.registerDefaults(true);
                ServerCodecConfigurer.ServerDefaultCodecs defaults = configure
                    .defaultCodecs();
                ObjectMapper objectMapper = Jackson2ObjectMapperBuilder.json()
                    .dateFormat(new StdDateFormat())
                    .modules(new JavaTimeModule()) // <-- „Åì„Åì„ÇíËøΩÂä†
                    .build();
                defaults.jackson2JsonEncoder(new Jackson2JsonEncoder(objectMapper));
                defaults.jackson2JsonDecoder(new Jackson2JsonDecoder(objectMapper));
            })
            .exceptionHandler(new ErrorResponseExceptionHandler())
            .build();
    }
```

> „Å°„Å™„Åø„Å´„ÄÅ`modules`„É°„ÇΩ„ÉÉ„Éâ„ÅßÊòéÁ§∫ÁöÑ„Å´ÁôªÈå≤„Åô„Çã‰ª£„Çè„Çä„Å´„ÄÅË®≠ÂÆö„Éï„Ç°„Ç§„É´„Åß„É™„Éï„É¨„ÇØ„Ç∑„Éß„É≥„ÇíÊúâÂäπ„Å´„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ<br>
> „Åù„ÅÆÂ†¥Âêà„ÅØ`src/main/resources/META-INF/native-image/com.example.moneyger/framework.json`„ÅÆJSONÈÖçÂàó„Å´Ê¨°„ÇíËøΩÂä†„Åô„Çå„Å∞ËâØ„ÅÑ„Åß„Åô„ÄÇ
> 
> ```json
>   {
>     "name": "com.fasterxml.jackson.datatype.jsr310.JavaTimeModule",
>     "allDeclaredConstructors": true,
>     "allDeclaredMethods": true
>   }
> ```


Ê¨°„Å´„ÄÅ`ConnectionFactory`„ÅÆÁîüÊàêÊñπÊ≥ï„ÇíÂ§âÊõ¥„Åó„Åæ„Åô„ÄÇ`ConnectionFactories.get`„ÅØ„ÇØ„É©„Çπ„É≠„Éº„ÉÄ„Éº„Åã„Çâ`ServiceLoader`„Åß`io.r2dbc.spi.ConnectionFactoryProvider`„Çí„É≠„Éº„Éâ„Åô„Çã„Åå„ÄÅ
„Åì„Çå„ÇÇNative Image‰∏ä„ÅßÂà©„Åã„Å™„ÅÑ„ÅÆ„Åß„ÄÅ‰ªäÂõû„ÅØÊòéÁ§∫ÁöÑ„Å´PostgreSQLÁî®„ÅÆ`PostgresqlConnectionFactory`„ÇíÁõ¥Êé•‰ΩúÊàê„Åô„Çã„Çà„ÅÜ„Å´Â§âÊõ¥„Åó„Åæ„Åô„ÄÇ

```java
    static ConnectionFactory connectionFactory() {
        // postgresql://username:password@hostname:5432/dbname
        String databaseUrl = System.getenv("DATABASE_URL");
        final URI uri = URI.create(databaseUrl);
        final PostgresqlConnectionConfiguration configuration = PostgresqlConnectionConfiguration.builder()
            .host(uri.getHost())
            .port(uri.getPort())
            .database(uri.getPath().substring(1))
            .username(uri.getUserInfo().split(":", 2)[0])
            .password(uri.getUserInfo().split(":", 2)[1])
            .build();
        return new PostgresqlConnectionFactory(configuration);
    }
```

### R2dbcExpenditureRepository.java„ÅÆÂ§âÊõ¥

`R2dbcExpenditureRepository`„Åß„ÅØSpring Data R2DBC„Å´„Çà„Çã„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Éû„ÉÉ„Éî„É≥„Ç∞„ÇÑSQLÁîüÊàê„ÇíËá™Âãï„ÅßË°å„Å™„Å£„Å¶„ÅÑ„Åæ„Åó„Åü„ÄÇ
„É™„Éï„É¨„ÇØ„Ç∑„Éß„É≥„ÇÑÂãïÁöÑProxy„Åå‰Ωø„Çè„Çå„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÄÅ„Åì„Åì„Åß„ÅØÊòéÁ§∫ÁöÑ„Å™„Éû„ÉÉ„Éî„É≥„Ç∞„ÇíË°å„ÅÜ„Çà„ÅÜ„Å´‰øÆÊ≠£„Åó„Åæ„Åô„ÄÇ

```java
package com.example.expenditure;

import io.r2dbc.spi.Row;
import org.springframework.data.r2dbc.core.DatabaseClient;
import org.springframework.transaction.reactive.TransactionalOperator;
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

import java.time.LocalDate;
import java.util.function.Function;

public class R2dbcExpenditureRepository implements ExpenditureRepository {

    private final DatabaseClient databaseClient;

    private final TransactionalOperator tx;

    @SuppressWarnings("ConstantConditions")
    private final Function<Row, Expenditure> rowExpenditureMapper = row -> new ExpenditureBuilder()
        .withExpenditureId(row.get("expenditure_id", Integer.class))
        .withExpenditureName(row.get("expenditure_name", String.class))
        .withQuantity(row.get("quantity", Integer.class))
        .withUnitPrice(row.get("unit_price", Integer.class))
        .withExpenditureDate(row.get("expenditure_date", LocalDate.class))
        .build();

    public R2dbcExpenditureRepository(DatabaseClient databaseClient, TransactionalOperator tx) {
        this.databaseClient = databaseClient;
        this.tx = tx;
    }

    @Override
    public Flux<Expenditure> findAll() {
        return this.databaseClient.execute("SELECT expenditure_id, expenditure_name, unit_price, quantity, expenditure_date FROM expenditure")
            .map(this.rowExpenditureMapper)
            .all();
    }

    @Override
    public Mono<Expenditure> findById(Integer expenditureId) {
        return this.databaseClient
            .execute("SELECT expenditure_id, expenditure_name, unit_price, quantity, expenditure_date FROM expenditure WHERE expenditure_id = :expenditure_id")
            .bind("expenditure_id", expenditureId)
            .map(this.rowExpenditureMapper)
            .one();
    }

    @Override
    public Mono<Expenditure> save(Expenditure expenditure) {
        final String databaseUrl = System.getenv("DATABASE_URL");
        if (databaseUrl != null && databaseUrl.contains("postgres") /* TODO ü§î */) {
            return this.databaseClient
                .execute("INSERT INTO expenditure(expenditure_name, unit_price, quantity, expenditure_date) VALUES(:expenditure_name, :unit_price, :quantity, :expenditure_date) RETURNING " +
                    "expenditure_id")
                .bind("expenditure_name", expenditure.getExpenditureName())
                .bind("unit_price", expenditure.getUnitPrice())
                .bind("quantity", expenditure.getQuantity())
                .bind("expenditure_date", expenditure.getExpenditureDate())
                .fetch()
                .one()
                .map(map -> new ExpenditureBuilder(expenditure)
                    .withExpenditureId((Integer) map.get("expenditure_id"))
                    .build())
                .as(this.tx::transactional);
        } else {
            return this.databaseClient
                .execute("INSERT INTO expenditure(expenditure_name, unit_price, quantity, expenditure_date) VALUES(:expenditure_name, :unit_price, :quantity, :expenditure_date)")
                .bind("expenditure_name", expenditure.getExpenditureName())
                .bind("unit_price", expenditure.getUnitPrice())
                .bind("quantity", expenditure.getQuantity())
                .bind("expenditure_date", expenditure.getExpenditureDate())
                .then()
                .then(/* TODO ü§î */ this.databaseClient.execute("CALL SCOPE_IDENTITY()").fetch().one()
                    .map(map -> new ExpenditureBuilder(expenditure)
                        .withExpenditureId(((Long) map.get("SCOPE_IDENTITY()")).intValue())
                        .build()))
                .as(this.tx::transactional);
        }
    }

    @Override
    public Mono<Void> deleteById(Integer expenditureId) {
        return this.databaseClient.execute("DELETE FROM expenditure WHERE expenditure_id = :expenditure_id")
            .bind("expenditure_id", expenditureId)
            .then()
            .as(this.tx::transactional);
    }
}
```

`R2dbcIncomeRepository`„ÇÇÂêåÊßò„Å´‰øÆÊ≠£„Åó„Åæ„Åô„ÄÇ

„ÇΩ„Éº„Çπ„Ç≥„Éº„ÉâÂ§âÊõ¥Âæå„ÇÇJUnit„ÅÆ„ÉÜ„Çπ„Éà„Åå‰æùÁÑ∂ÊàêÂäü„Åô„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

### „É™„Éï„É¨„ÇØ„Ç∑„Éß„É≥„ÅÆÂÆöÁæ©

Jackson„Å´„Çà„ÇãJSON„ÅÆ„Ç∑„É™„Ç¢„É©„Ç§„Ç∫„ÄÅ„Éá„Ç∑„É™„Ç¢„É©„Ç§„Ç∫„ÅØ„É™„Éï„É¨„ÇØ„Ç∑„Éß„É≥„ÅßË°å„Çè„Çå„Åæ„Åô„ÄÇ„Ç¢„Éó„É™ÂÅ¥„ÅßJSON„Ç∑„É™„Ç¢„É©„Ç§„Ç∫„ÄÅ„Éá„Ç∑„É™„Ç¢„É©„Ç§„Ç∫ÂØæË±°„Å®„Å™„Çã„ÇØ„É©„Çπ„ÅØ
`src/main/resources/META-INF/native-image/com.example.moneyger/app.json`„ÅßÊ¨°„ÅÆ„Çà„ÅÜ„Å´ÂÆöÁæ©„Åó„Åæ„Åô„ÄÇ

```json
[
  {
    "name": "com.example.expenditure.Expenditure",
    "allDeclaredConstructors": true,
    "allDeclaredMethods": true
  },
  {
    "name": "com.example.expenditure.ExpenditureBuilder",
    "allDeclaredConstructors": true,
    "allDeclaredMethods": true
  },
  {
    "name": "com.example.income.Income",
    "allDeclaredConstructors": true,
    "allDeclaredMethods": true
  },
  {
    "name": "com.example.income.IncomeBuilder",
    "allDeclaredConstructors": true,
    "allDeclaredMethods": true
  },
  {
    "name": "com.example.error.ErrorResponse",
    "allDeclaredConstructors": true,
    "allDeclaredMethods": true
  }
] 
```

### Native Image„ÅÆ„Éì„É´„Éâ

[GraalVM 19.2.0](https://github.com/oracle/graal/releases/tag/vm-19.2.0)„Çí„Ç§„É≥„Çπ„Éà„Éº„É´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
`JAVA_HOME`„ÇíÊõ¥Êñ∞„Åó„ÅüÂæå„ÄÅÊ¨°„ÅÆ„Ç≥„Éû„É≥„Éâ„ÇíÂÆüË°å„Åó„Å¶„ÄÅ`native-image`

```
gu install native-image
```

„Åß


```
export DATABASE_URL=postgresql://<username>:<password>@localhost:5432/moneyger

mvn clean package -Pgraal -DskipTests=true
```

Ê¨°„ÅÆ„Çà„ÅÜ„Å´„Éì„É´„Éâ„Åå„Åß„Åç„Åæ„Åô„ÄÇ

```
$ mvn clean package -Pgraal -DskipTests=true
[INFO] Scanning for projects...
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] Building moneyger 1.0.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ moneyger ---
[INFO] Deleting /Users/maki/handson/moneyger/target
[INFO] 
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ moneyger ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 8 resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ moneyger ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 10 source files to /Users/maki/handson/moneyger/target/classes
[INFO] 
[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ moneyger ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 1 resource
[INFO] 
[INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ moneyger ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 2 source files to /Users/maki/handson/moneyger/target/test-classes
[INFO] 
[INFO] --- maven-surefire-plugin:2.22.0:test (default-test) @ moneyger ---
[INFO] Tests are skipped.
[INFO] 
[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ moneyger ---
[INFO] Building jar: /Users/maki/handson/moneyger/target/moneyger-1.0.0-SNAPSHOT.jar
[INFO] 
[INFO] --- native-image-maven-plugin:19.2.0:native-image (default) @ moneyger ---
[INFO] ImageClasspath Entry: com.github.making:moneyger-ui:jar:master-7d3a8b2729-1:compile (file:///Users/maki/.m2/repository/com/github/making/moneyger-ui/master-7d3a8b2729-1/moneyger-ui-master-7d3a8b2729-1.jar)
[INFO] ImageClasspath Entry: org.springframework:spring-context:jar:5.2.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/spring-context/5.2.0.BUILD-SNAPSHOT/spring-context-5.2.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: org.springframework:spring-aop:jar:5.2.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/spring-aop/5.2.0.BUILD-SNAPSHOT/spring-aop-5.2.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: org.springframework:spring-beans:jar:5.2.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/spring-beans/5.2.0.BUILD-SNAPSHOT/spring-beans-5.2.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: org.springframework:spring-core:jar:5.2.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/spring-core/5.2.0.BUILD-SNAPSHOT/spring-core-5.2.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: org.springframework:spring-jcl:jar:5.2.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/spring-jcl/5.2.0.BUILD-SNAPSHOT/spring-jcl-5.2.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: org.springframework:spring-expression:jar:5.2.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/spring-expression/5.2.0.BUILD-SNAPSHOT/spring-expression-5.2.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: org.springframework:spring-webflux:jar:5.2.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/spring-webflux/5.2.0.BUILD-SNAPSHOT/spring-webflux-5.2.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: org.springframework:spring-web:jar:5.2.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/spring-web/5.2.0.BUILD-SNAPSHOT/spring-web-5.2.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: io.projectreactor:reactor-core:jar:3.3.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/io/projectreactor/reactor-core/3.3.0.BUILD-SNAPSHOT/reactor-core-3.3.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: org.reactivestreams:reactive-streams:jar:1.0.3:compile (file:///Users/maki/.m2/repository/org/reactivestreams/reactive-streams/1.0.3/reactive-streams-1.0.3.jar)
[INFO] ImageClasspath Entry: ch.qos.logback:logback-classic:jar:1.2.3:compile (file:///Users/maki/.m2/repository/ch/qos/logback/logback-classic/1.2.3/logback-classic-1.2.3.jar)
[INFO] ImageClasspath Entry: ch.qos.logback:logback-core:jar:1.2.3:compile (file:///Users/maki/.m2/repository/ch/qos/logback/logback-core/1.2.3/logback-core-1.2.3.jar)
[INFO] ImageClasspath Entry: org.slf4j:slf4j-api:jar:1.7.28:compile (file:///Users/maki/.m2/repository/org/slf4j/slf4j-api/1.7.28/slf4j-api-1.7.28.jar)
[INFO] ImageClasspath Entry: io.projectreactor.netty:reactor-netty:jar:0.9.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/io/projectreactor/netty/reactor-netty/0.9.0.BUILD-SNAPSHOT/reactor-netty-0.9.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: io.netty:netty-codec-http:jar:4.1.39.Final:compile (file:///Users/maki/.m2/repository/io/netty/netty-codec-http/4.1.39.Final/netty-codec-http-4.1.39.Final.jar)
[WARNING] jar:file:///Users/maki/.m2/repository/io/netty/netty-codec-http/4.1.39.Final/netty-codec-http-4.1.39.Final.jar!/META-INF/native-image/io.netty/codec-http/native-image.properties does not match recommended META-INF/native-image/${groupId}/${artifactId}/native-image.properties layout.
[INFO] ImageClasspath Entry: io.netty:netty-common:jar:4.1.39.Final:compile (file:///Users/maki/.m2/repository/io/netty/netty-common/4.1.39.Final/netty-common-4.1.39.Final.jar)
[INFO] ImageClasspath Entry: io.netty:netty-buffer:jar:4.1.39.Final:compile (file:///Users/maki/.m2/repository/io/netty/netty-buffer/4.1.39.Final/netty-buffer-4.1.39.Final.jar)
[INFO] ImageClasspath Entry: io.netty:netty-transport:jar:4.1.39.Final:compile (file:///Users/maki/.m2/repository/io/netty/netty-transport/4.1.39.Final/netty-transport-4.1.39.Final.jar)
[WARNING] jar:file:///Users/maki/.m2/repository/io/netty/netty-transport/4.1.39.Final/netty-transport-4.1.39.Final.jar!/META-INF/native-image/io.netty/transport/native-image.properties does not match recommended META-INF/native-image/${groupId}/${artifactId}/native-image.properties layout.
[INFO] ImageClasspath Entry: io.netty:netty-resolver:jar:4.1.39.Final:compile (file:///Users/maki/.m2/repository/io/netty/netty-resolver/4.1.39.Final/netty-resolver-4.1.39.Final.jar)
[INFO] ImageClasspath Entry: io.netty:netty-codec:jar:4.1.39.Final:compile (file:///Users/maki/.m2/repository/io/netty/netty-codec/4.1.39.Final/netty-codec-4.1.39.Final.jar)
[INFO] ImageClasspath Entry: io.netty:netty-handler:jar:4.1.39.Final:compile (file:///Users/maki/.m2/repository/io/netty/netty-handler/4.1.39.Final/netty-handler-4.1.39.Final.jar)
[INFO] ImageClasspath Entry: io.netty:netty-handler-proxy:jar:4.1.39.Final:compile (file:///Users/maki/.m2/repository/io/netty/netty-handler-proxy/4.1.39.Final/netty-handler-proxy-4.1.39.Final.jar)
[INFO] ImageClasspath Entry: io.netty:netty-codec-socks:jar:4.1.39.Final:compile (file:///Users/maki/.m2/repository/io/netty/netty-codec-socks/4.1.39.Final/netty-codec-socks-4.1.39.Final.jar)
[INFO] ImageClasspath Entry: io.projectreactor.addons:reactor-pool:jar:0.1.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/io/projectreactor/addons/reactor-pool/0.1.0.BUILD-SNAPSHOT/reactor-pool-0.1.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: com.fasterxml.jackson.core:jackson-databind:jar:2.9.9.3:compile (file:///Users/maki/.m2/repository/com/fasterxml/jackson/core/jackson-databind/2.9.9.3/jackson-databind-2.9.9.3.jar)
[INFO] ImageClasspath Entry: com.fasterxml.jackson.core:jackson-annotations:jar:2.9.0:compile (file:///Users/maki/.m2/repository/com/fasterxml/jackson/core/jackson-annotations/2.9.0/jackson-annotations-2.9.0.jar)
[INFO] ImageClasspath Entry: com.fasterxml.jackson.core:jackson-core:jar:2.9.9:compile (file:///Users/maki/.m2/repository/com/fasterxml/jackson/core/jackson-core/2.9.9/jackson-core-2.9.9.jar)
[INFO] ImageClasspath Entry: com.fasterxml.jackson.datatype:jackson-datatype-jsr310:jar:2.9.9:compile (file:///Users/maki/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jsr310/2.9.9/jackson-datatype-jsr310-2.9.9.jar)
[INFO] ImageClasspath Entry: am.ik.yavi:yavi:jar:0.2.2:compile (file:///Users/maki/.m2/repository/am/ik/yavi/yavi/0.2.2/yavi-0.2.2.jar)
[INFO] ImageClasspath Entry: org.springframework.data:spring-data-r2dbc:jar:1.0.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/data/spring-data-r2dbc/1.0.0.BUILD-SNAPSHOT/spring-data-r2dbc-1.0.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: org.springframework.data:spring-data-commons:jar:2.2.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/data/spring-data-commons/2.2.0.BUILD-SNAPSHOT/spring-data-commons-2.2.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: org.springframework.data:spring-data-relational:jar:1.1.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/data/spring-data-relational/1.1.0.BUILD-SNAPSHOT/spring-data-relational-1.1.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: org.springframework:spring-tx:jar:5.2.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/spring-tx/5.2.0.BUILD-SNAPSHOT/spring-tx-5.2.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: io.r2dbc:r2dbc-spi:jar:0.8.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/io/r2dbc/r2dbc-spi/0.8.0.BUILD-SNAPSHOT/r2dbc-spi-0.8.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: io.r2dbc:r2dbc-h2:jar:0.8.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/io/r2dbc/r2dbc-h2/0.8.0.BUILD-SNAPSHOT/r2dbc-h2-0.8.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: com.h2database:h2:jar:1.4.199:compile (file:///Users/maki/.m2/repository/com/h2database/h2/1.4.199/h2-1.4.199.jar)
[INFO] ImageClasspath Entry: org.apache.commons:commons-lang3:jar:3.9:compile (file:///Users/maki/.m2/repository/org/apache/commons/commons-lang3/3.9/commons-lang3-3.9.jar)
[INFO] ImageClasspath Entry: io.r2dbc:r2dbc-postgresql:jar:0.8.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/io/r2dbc/r2dbc-postgresql/0.8.0.BUILD-SNAPSHOT/r2dbc-postgresql-0.8.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: com.ongres.scram:client:jar:1.0.0-beta.2:compile (file:///Users/maki/.m2/repository/com/ongres/scram/client/1.0.0-beta.2/client-1.0.0-beta.2.jar)
[INFO] ImageClasspath Entry: com.ongres.scram:common:jar:1.0.0-beta.2:compile (file:///Users/maki/.m2/repository/com/ongres/scram/common/1.0.0-beta.2/common-1.0.0-beta.2.jar)
[INFO] ImageClasspath Entry: io.r2dbc:r2dbc-pool:jar:0.8.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/io/r2dbc/r2dbc-pool/0.8.0.BUILD-SNAPSHOT/r2dbc-pool-0.8.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: org.springframework:spring-test:jar:5.2.0.BUILD-SNAPSHOT:compile (file:///Users/maki/.m2/repository/org/springframework/spring-test/5.2.0.BUILD-SNAPSHOT/spring-test-5.2.0.BUILD-SNAPSHOT.jar)
[INFO] ImageClasspath Entry: com.example:moneyger:jar:1.0.0-SNAPSHOT (file:///Users/maki/handson/moneyger/target/moneyger-1.0.0-SNAPSHOT.jar)
[INFO] Executing: /Users/maki/.sdkman/candidates/java/19.2.0-grl/jre/bin/native-image -cp /Users/maki/.m2/repository/com/github/making/moneyger-ui/master-7d3a8b2729-1/moneyger-ui-master-7d3a8b2729-1.jar:/Users/maki/.m2/repository/org/springframework/spring-context/5.2.0.BUILD-SNAPSHOT/spring-context-5.2.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/org/springframework/spring-aop/5.2.0.BUILD-SNAPSHOT/spring-aop-5.2.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/org/springframework/spring-beans/5.2.0.BUILD-SNAPSHOT/spring-beans-5.2.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/org/springframework/spring-core/5.2.0.BUILD-SNAPSHOT/spring-core-5.2.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/org/springframework/spring-jcl/5.2.0.BUILD-SNAPSHOT/spring-jcl-5.2.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/org/springframework/spring-expression/5.2.0.BUILD-SNAPSHOT/spring-expression-5.2.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/org/springframework/spring-webflux/5.2.0.BUILD-SNAPSHOT/spring-webflux-5.2.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/org/springframework/spring-web/5.2.0.BUILD-SNAPSHOT/spring-web-5.2.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/io/projectreactor/reactor-core/3.3.0.BUILD-SNAPSHOT/reactor-core-3.3.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/org/reactivestreams/reactive-streams/1.0.3/reactive-streams-1.0.3.jar:/Users/maki/.m2/repository/ch/qos/logback/logback-classic/1.2.3/logback-classic-1.2.3.jar:/Users/maki/.m2/repository/ch/qos/logback/logback-core/1.2.3/logback-core-1.2.3.jar:/Users/maki/.m2/repository/org/slf4j/slf4j-api/1.7.28/slf4j-api-1.7.28.jar:/Users/maki/.m2/repository/io/projectreactor/netty/reactor-netty/0.9.0.BUILD-SNAPSHOT/reactor-netty-0.9.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/io/netty/netty-codec-http/4.1.39.Final/netty-codec-http-4.1.39.Final.jar:/Users/maki/.m2/repository/io/netty/netty-common/4.1.39.Final/netty-common-4.1.39.Final.jar:/Users/maki/.m2/repository/io/netty/netty-buffer/4.1.39.Final/netty-buffer-4.1.39.Final.jar:/Users/maki/.m2/repository/io/netty/netty-transport/4.1.39.Final/netty-transport-4.1.39.Final.jar:/Users/maki/.m2/repository/io/netty/netty-resolver/4.1.39.Final/netty-resolver-4.1.39.Final.jar:/Users/maki/.m2/repository/io/netty/netty-codec/4.1.39.Final/netty-codec-4.1.39.Final.jar:/Users/maki/.m2/repository/io/netty/netty-handler/4.1.39.Final/netty-handler-4.1.39.Final.jar:/Users/maki/.m2/repository/io/netty/netty-handler-proxy/4.1.39.Final/netty-handler-proxy-4.1.39.Final.jar:/Users/maki/.m2/repository/io/netty/netty-codec-socks/4.1.39.Final/netty-codec-socks-4.1.39.Final.jar:/Users/maki/.m2/repository/io/projectreactor/addons/reactor-pool/0.1.0.BUILD-SNAPSHOT/reactor-pool-0.1.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/com/fasterxml/jackson/core/jackson-databind/2.9.9.3/jackson-databind-2.9.9.3.jar:/Users/maki/.m2/repository/com/fasterxml/jackson/core/jackson-annotations/2.9.0/jackson-annotations-2.9.0.jar:/Users/maki/.m2/repository/com/fasterxml/jackson/core/jackson-core/2.9.9/jackson-core-2.9.9.jar:/Users/maki/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jsr310/2.9.9/jackson-datatype-jsr310-2.9.9.jar:/Users/maki/.m2/repository/am/ik/yavi/yavi/0.2.2/yavi-0.2.2.jar:/Users/maki/.m2/repository/org/springframework/data/spring-data-r2dbc/1.0.0.BUILD-SNAPSHOT/spring-data-r2dbc-1.0.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/org/springframework/data/spring-data-commons/2.2.0.BUILD-SNAPSHOT/spring-data-commons-2.2.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/org/springframework/data/spring-data-relational/1.1.0.BUILD-SNAPSHOT/spring-data-relational-1.1.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/org/springframework/spring-tx/5.2.0.BUILD-SNAPSHOT/spring-tx-5.2.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/io/r2dbc/r2dbc-spi/0.8.0.BUILD-SNAPSHOT/r2dbc-spi-0.8.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/io/r2dbc/r2dbc-h2/0.8.0.BUILD-SNAPSHOT/r2dbc-h2-0.8.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/com/h2database/h2/1.4.199/h2-1.4.199.jar:/Users/maki/.m2/repository/org/apache/commons/commons-lang3/3.9/commons-lang3-3.9.jar:/Users/maki/.m2/repository/io/r2dbc/r2dbc-postgresql/0.8.0.BUILD-SNAPSHOT/r2dbc-postgresql-0.8.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/com/ongres/scram/client/1.0.0-beta.2/client-1.0.0-beta.2.jar:/Users/maki/.m2/repository/com/ongres/scram/common/1.0.0-beta.2/common-1.0.0-beta.2.jar:/Users/maki/.m2/repository/io/r2dbc/r2dbc-pool/0.8.0.BUILD-SNAPSHOT/r2dbc-pool-0.8.0.BUILD-SNAPSHOT.jar:/Users/maki/.m2/repository/org/springframework/spring-test/5.2.0.BUILD-SNAPSHOT/spring-test-5.2.0.BUILD-SNAPSHOT.jar:/Users/maki/handson/moneyger/target/moneyger-1.0.0-SNAPSHOT.jar -H:Class=com.example.App -H:Name=moneyger
[moneyger:15419]    classlist:   6,196.53 ms
[moneyger:15419]        (cap):   1,641.41 ms
[moneyger:15419]        setup:   3,431.27 ms
ScriptEngineManager providers.next(): javax.script.ScriptEngineFactory: Provider com.oracle.truffle.js.scriptengine.GraalJSEngineFactory could not be instantiated
ScriptEngineManager providers.next(): javax.script.ScriptEngineFactory: Provider com.oracle.truffle.js.scriptengine.GraalJSEngineFactory could not be instantiated
[moneyger:15419]   (typeflow):  20,420.66 ms
[moneyger:15419]    (objects):  12,896.53 ms
[moneyger:15419]   (features):   1,562.57 ms
[moneyger:15419]     analysis:  36,596.97 ms
[moneyger:15419]     (clinit):     868.41 ms
[moneyger:15419]     universe:   1,846.08 ms
[moneyger:15419]      (parse):   3,072.85 ms
[moneyger:15419]     (inline):   6,360.03 ms
[moneyger:15419]    (compile):  26,694.54 ms
[moneyger:15419]      compile:  38,162.44 ms
[moneyger:15419]        image:   3,108.36 ms
[moneyger:15419]        write:   1,127.10 ms
[moneyger:15419]      [total]:  90,727.56 ms
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 01:34 min
[INFO] Finished at: 2019-09-05T17:56:16+09:00
[INFO] Final Memory: 38M/357M
[INFO] ------------------------------------------------------------------------
```


`psql`„Åß`CREATE DATABASE moneyger;`„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ


Native Image„ÅÆ„Éê„Ç§„Éä„É™„ÅØ`./target/classes/moneyger`„Åß„Åô„ÄÇ„Åì„Çå„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

```
$ ./target/classes/moneyger 
Sep 05, 2019 6:00:02 PM com.fasterxml.jackson.databind.ext.Java7Support <clinit>
WARNING: Unable to load JDK7 types (annotations, java.nio.file.Path): no Java7 support added
2019-09-05 18:00:02.597  INFO --- [           main] com.example.App                          : Started in 0.009 seconds
```

„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åôüéâ

Docker„Åß„ÇÇ„Éì„É´„Éâ„Åß„Åç„Åæ„Åô„ÄÇ

```
chmod +x mvnw
docker run --rm \
           -v "$PWD":/usr/src \
           -v "$HOME/.m2":/root/.m2 \
           -w /usr/src \
           oracle/graalvm-ce:19.2.0 \
           ./mvnw clean package -Pgraal -DskipTests=true
```

„Åì„Åì„ÅßÁîüÊàê„Åï„Çå„Çã„Éê„Ç§„Éä„É™„ÅØLinuxÁî®„Åß„Åô„ÄÇ

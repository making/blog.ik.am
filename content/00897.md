---
title: VMware Tanzu RabbitMQ on KubernetesのHelm Chartをリロケートしてインストールするメモ
summary: この記事ではVMware Tanzu RabbitMQ on KubernetesのHelm Chartをリロケートしてインストールする手順を説明します。
tags: ["Kubernetes", "Tanzu", "RabbitMQ", "Helm"]
categories: ["Dev", "CaaS", "Kubernetes", "TanzuRabbitMQ"]
date: 2026-02-10T10:18:31.159Z
updated: 2026-02-10T10:18:31.159Z
---

> [!WARNING]
> Work in Progress

https://techdocs.broadcom.com/us/en/vmware-tanzu/data-solutions/tanzu-rabbitmq-on-kubernetes/4-2/tanzu-rabbitmq-kubernetes/installation-using-helm.html

cert-managerがインストール済みの状態を前提とします。

### Helm Chartのリロケート

https://support.broadcom.com にログインして、"My Downloads"ページにアクセスし、"Registry Tokens"ボタンをクリック。


![image](https://s3.ik.am/ikam/_/1770692193915_pasted-image.png)


"Generate Registry Token"ボタンをクリックして、"Submit"ボタンをクリック。


![image](https://s3.ik.am/ikam/_/1770692238297_pasted-image.png)


生成されたトークンの"Copy Token"ボタンをクリックし、トークンをクリップボードにコピーします。


![image](https://s3.ik.am/ikam/_/1770692268848_pasted-image.png)


```bash
export BROADCOM_USERNAME=your-email-address@example.com
export BROADCOM_TOKEN=eyJ2ZXIiO.....
```


```bash
docker login rabbitmq-helmoci.packages.broadcom.com -u ${BROADCOM_USERNAME} -p ${BROADCOM_TOKEN}
docker login rabbitmq-operator.packages.broadcom.com -u ${BROADCOM_USERNAME} -p ${BROADCOM_TOKEN}
docker login rabbitmq.packages.broadcom.com -u ${BROADCOM_USERNAME} -p ${BROADCOM_TOKEN}
```

"Login Succeeded"と出力されればOKです。

Helmプラグインである"[Distribution Tooling for Helm](https://github.com/vmware-labs/distribution-tooling-for-helm)"を使います。

次のコマンドでインストールできます。

```bash
helm plugin install https://github.com/vmware-labs/distribution-tooling-for-helm
```

[VMware Tanzu RabbitMQ on Kubernetesのダウンロードページ](https://support.broadcom.com/group/ecx/productdownloads?subfamily=VMware%20Tanzu%20RabbitMQ%20on%20Kubernetes)にアクセスし、最新のバージョン（ここでは4.2.3）を確認します。

```bash
helm dt wrap oci://rabbitmq-helmoci.packages.broadcom.com/tanzu-rabbitmq-operators --version 4.2.3
```

次のように出力されればOKです。認証エラーになる場合は、`docker login`が漏れています。

![pasted-image.png](https://s3.ik.am/ikam/_/1770692992860_pasted-image.png)


```bash
export REGISTRY_HOST=registry.example.com
export REGISTRY_USERNAME=changeme
export REGISTRY_PASSWORD=changeme

docker login ${REGISTRY_HOST} -u ${REGISTRY_USERNAME} -p ${REGISTRY_PASSWORD}
```

```bash
helm dt unwrap tanzu-rabbitmq-operators-4.2.3.wrap.tgz ${REGISTRY_HOST}/tanzu-rabbitmq --yes
```

![image](https://s3.ik.am/ikam/_/1770695325149_pasted-image.png)


```yaml
$ helm show values oci://${REGISTRY_HOST}/tanzu-rabbitmq/tanzu-rabbitmq-operators | grep 'registry:' -A 1
Pulled: registry.example.com/tanzu-rabbitmq/tanzu-rabbitmq-operators:4.2.3
Digest: sha256:2faca9c439fe447f995285270c940c5a0930391bf7345bcc14872ae30f0d3b7b
  registry: registry.example.com
  repository: tanzu-rabbitmq/vmware-tanzu-rabbitmq
--
  registry: registry.example.com
  repository: tanzu-rabbitmq/default-user-credential-updater
--
    registry: registry.example.com
    repository: tanzu-rabbitmq/cluster-operator
--
    registry: registry.example.com
    repository: tanzu-rabbitmq/messaging-topology-operator
--
    registry: registry.example.com
    repository: tanzu-rabbitmq/audit-logger
```


```bash
kubectl create namespace rabbitmq-system

kubectl create secret docker-registry -n rabbitmq-system tanzu-rabbitmq-registry-creds \
  --docker-server ${REGISTRY_HOST} \
  --docker-username ${REGISTRY_USERNAME} \
  --docker-password ${REGISTRY_PASSWORD}
```

### RabbitMQ Opeartorのインストール

```bash
helm upgrade tanzu-rabbitmq oci://${REGISTRY_HOST}/tanzu-rabbitmq/tanzu-rabbitmq-operators -n rabbitmq-system --version 4.2.3 --install --wait
```

```bash
$ helm list -n rabbitmq-system
NAME          	NAMESPACE      	REVISION	UPDATED                             	STATUS  	CHART                         	APP VERSION
tanzu-rabbitmq	rabbitmq-system	1       	2026-02-10 12:55:23.896299 +0900 JST	deployed	tanzu-rabbitmq-operators-4.2.3	4.2.3 
```

```bash
$ kubectl get pod -n rabbitmq-system       
NAME                                           READY   STATUS    RESTARTS   AGE
messaging-topology-operator-7cdd799697-n97t7   1/1     Running   0          60s
rabbitmq-cluster-operator-6fdfbf966f-8mmtg     1/1     Running   0          60s
```

```bash
$ kubectl api-resources --api-group=rabbitmq.com        
NAME                 SHORTNAMES   APIVERSION              NAMESPACED   KIND
bindings                          rabbitmq.com/v1beta1    true         Binding
exchanges                         rabbitmq.com/v1beta1    true         Exchange
federations                       rabbitmq.com/v1beta1    true         Federation
operatorpolicies                  rabbitmq.com/v1beta1    true         OperatorPolicy
permissions                       rabbitmq.com/v1beta1    true         Permission
policies                          rabbitmq.com/v1beta1    true         Policy
queues                            rabbitmq.com/v1beta1    true         Queue
rabbitmqclusters     rmq          rabbitmq.com/v1beta1    true         RabbitmqCluster
schemareplications                rabbitmq.com/v1beta1    true         SchemaReplication
shovels                           rabbitmq.com/v1beta1    true         Shovel
superstreams                      rabbitmq.com/v1alpha1   true         SuperStream
topicpermissions                  rabbitmq.com/v1beta1    true         TopicPermission
users                             rabbitmq.com/v1beta1    true         User
vhosts                            rabbitmq.com/v1beta1    true         Vhost
```

### RabbitMQ Clusterの作成


```bash
kubectl create ns demo
kubectl create secret docker-registry -n demo tanzu-rabbitmq-registry-creds \
  --docker-server ${REGISTRY_HOST} \
  --docker-username ${REGISTRY_USERNAME} \
  --docker-password ${REGISTRY_PASSWORD}
```

```yaml
cat <<EOF > rabbitmq.yaml
apiVersion: rabbitmq.com/v1beta1
kind: RabbitmqCluster
metadata:
  name: demo-rabbitmq
  namespace: demo
spec:
  imagePullSecrets:
  - name: tanzu-rabbitmq-registry-creds
  service:
    type: LoadBalancer
  replicas: 3
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
              - demo-rabbitmq
          topologyKey: kubernetes.io/hostname
EOF

kubectl apply -f rabbitmq.yaml
```
